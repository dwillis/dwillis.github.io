<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Advanced rvest | Data Journalism with R and the Tidyverse</title>
  <meta name="description" content="This is a book built on a very opinionated philosophy for journalism students doing data journalism in R with replicable methods." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Advanced rvest | Data Journalism with R and the Tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book built on a very opinionated philosophy for journalism students doing data journalism in R with replicable methods." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Advanced rvest | Data Journalism with R and the Tidyverse" />
  
  <meta name="twitter:description" content="This is a book built on a very opinionated philosophy for journalism students doing data journalism in R with replicable methods." />
  

<meta name="author" content="Matt Waite (original author); updated by Derek Willis and Sean Mussenden" />


<meta name="date" content="2021-11-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="scraping-data-with-rvest.html"/>
<link rel="next" href="intro-to-apis-the-census.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160712129-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160712129-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://smussenden.github.io/coursefiles/data_journalism_book/">Data Journalism With R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#modern-data-journalism"><i class="fa fa-check"></i><b>1.1</b> Modern data journalism</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installations"><i class="fa fa-check"></i><b>1.2</b> Installations</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.3</b> About this book</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#what-well-cover"><i class="fa fa-check"></i><b>1.4</b> What we’ll cover</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="public-records.html"><a href="public-records.html"><i class="fa fa-check"></i><b>2</b> Public records</a>
<ul>
<li class="chapter" data-level="2.1" data-path="public-records.html"><a href="public-records.html#federal-law"><i class="fa fa-check"></i><b>2.1</b> Federal law</a></li>
<li class="chapter" data-level="2.2" data-path="public-records.html"><a href="public-records.html#state-law"><i class="fa fa-check"></i><b>2.2</b> State law</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>3</b> R basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-basics.html"><a href="r-basics.html#about-libraries"><i class="fa fa-check"></i><b>3.1</b> About libraries</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html"><i class="fa fa-check"></i><b>4</b> Data journalism in the age of replication</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#the-stylebook"><i class="fa fa-check"></i><b>4.1</b> The stylebook</a></li>
<li class="chapter" data-level="4.2" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#replication"><i class="fa fa-check"></i><b>4.2</b> Replication</a></li>
<li class="chapter" data-level="4.3" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#goodbye-excel"><i class="fa fa-check"></i><b>4.3</b> Goodbye Excel?</a></li>
<li class="chapter" data-level="4.4" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#receptivity-is-high"><i class="fa fa-check"></i><b>4.4</b> “Receptivity … is high”</a></li>
<li class="chapter" data-level="4.5" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#replication-in-notebooks"><i class="fa fa-check"></i><b>4.5</b> Replication in notebooks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html"><i class="fa fa-check"></i><b>5</b> Data, structures and types</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#a-mental-picture"><i class="fa fa-check"></i><b>5.1</b> A Mental Picture</a></li>
<li class="chapter" data-level="5.2" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#types"><i class="fa fa-check"></i><b>5.2</b> Types</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="aggregates.html"><a href="aggregates.html"><i class="fa fa-check"></i><b>6</b> Aggregates</a>
<ul>
<li class="chapter" data-level="6.1" data-path="aggregates.html"><a href="aggregates.html#libraries"><i class="fa fa-check"></i><b>6.1</b> Libraries</a></li>
<li class="chapter" data-level="6.2" data-path="aggregates.html"><a href="aggregates.html#importing-data"><i class="fa fa-check"></i><b>6.2</b> Importing data</a></li>
<li class="chapter" data-level="6.3" data-path="aggregates.html"><a href="aggregates.html#group-by-and-count"><i class="fa fa-check"></i><b>6.3</b> Group by and count</a></li>
<li class="chapter" data-level="6.4" data-path="aggregates.html"><a href="aggregates.html#other-summarization-methods-summing-mean-median-min-and-max"><i class="fa fa-check"></i><b>6.4</b> Other summarization methods: summing, mean, median, min and max</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mutating-data.html"><a href="mutating-data.html"><i class="fa fa-check"></i><b>7</b> Mutating data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mutating-data.html"><a href="mutating-data.html#another-use-of-mutate"><i class="fa fa-check"></i><b>7.1</b> Another use of mutate</a></li>
<li class="chapter" data-level="7.2" data-path="mutating-data.html"><a href="mutating-data.html#a-more-powerful-use"><i class="fa fa-check"></i><b>7.2</b> A more powerful use</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="working-with-dates.html"><a href="working-with-dates.html"><i class="fa fa-check"></i><b>8</b> Working with dates</a>
<ul>
<li class="chapter" data-level="8.1" data-path="working-with-dates.html"><a href="working-with-dates.html#the-hard-way"><i class="fa fa-check"></i><b>8.1</b> The hard way</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="filters-and-selections.html"><a href="filters-and-selections.html"><i class="fa fa-check"></i><b>9</b> Filters and selections</a>
<ul>
<li class="chapter" data-level="9.1" data-path="filters-and-selections.html"><a href="filters-and-selections.html#combining-filters"><i class="fa fa-check"></i><b>9.1</b> Combining filters</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html"><i class="fa fa-check"></i><b>10</b> Data Cleaning Part I: Data smells</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#wrong-type"><i class="fa fa-check"></i><b>10.1</b> Wrong Type</a></li>
<li class="chapter" data-level="10.2" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#missing-data"><i class="fa fa-check"></i><b>10.2</b> Missing Data</a></li>
<li class="chapter" data-level="10.3" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#gaps-in-data"><i class="fa fa-check"></i><b>10.3</b> Gaps in data</a></li>
<li class="chapter" data-level="10.4" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#supicious-outliers"><i class="fa fa-check"></i><b>10.4</b> Supicious Outliers</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html"><i class="fa fa-check"></i><b>11</b> Data Cleaning Part II: Janitor</a>
<ul>
<li class="chapter" data-level="11.1" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#cleaning-headers"><i class="fa fa-check"></i><b>11.1</b> Cleaning headers</a></li>
<li class="chapter" data-level="11.2" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#changing-data-types"><i class="fa fa-check"></i><b>11.2</b> Changing data types</a></li>
<li class="chapter" data-level="11.3" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#duplicates"><i class="fa fa-check"></i><b>11.3</b> Duplicates</a></li>
<li class="chapter" data-level="11.4" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#cleaning-strings"><i class="fa fa-check"></i><b>11.4</b> Cleaning strings</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="data-cleaning-part-iii-open-refine.html"><a href="data-cleaning-part-iii-open-refine.html"><i class="fa fa-check"></i><b>12</b> Data Cleaning Part III: Open Refine</a>
<ul>
<li class="chapter" data-level="12.1" data-path="data-cleaning-part-iii-open-refine.html"><a href="data-cleaning-part-iii-open-refine.html#refinr-open-refine-in-r"><i class="fa fa-check"></i><b>12.1</b> Refinr, Open Refine in R</a></li>
<li class="chapter" data-level="12.2" data-path="data-cleaning-part-iii-open-refine.html"><a href="data-cleaning-part-iii-open-refine.html#manually-cleaning-data-with-open-refine"><i class="fa fa-check"></i><b>12.2</b> Manually cleaning data with Open Refine</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html"><i class="fa fa-check"></i><b>13</b> Cleaning Data Part IV: PDFs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html#easy-does-it"><i class="fa fa-check"></i><b>13.1</b> Easy does it</a></li>
<li class="chapter" data-level="13.2" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html#when-it-looks-good-but-needs-a-little-fixing"><i class="fa fa-check"></i><b>13.2</b> When it looks good, but needs a little fixing</a></li>
<li class="chapter" data-level="13.3" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html#cleaning-up-the-data-in-r"><i class="fa fa-check"></i><b>13.3</b> Cleaning up the data in R</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="combining-and-joining.html"><a href="combining-and-joining.html"><i class="fa fa-check"></i><b>14</b> Combining and joining</a>
<ul>
<li class="chapter" data-level="14.1" data-path="combining-and-joining.html"><a href="combining-and-joining.html#combining-data-stacking"><i class="fa fa-check"></i><b>14.1</b> Combining data (stacking)</a></li>
<li class="chapter" data-level="14.2" data-path="combining-and-joining.html"><a href="combining-and-joining.html#joining-data"><i class="fa fa-check"></i><b>14.2</b> Joining data</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="scraping-data-with-rvest.html"><a href="scraping-data-with-rvest.html"><i class="fa fa-check"></i><b>15</b> Scraping data with Rvest</a></li>
<li class="chapter" data-level="16" data-path="advanced-rvest.html"><a href="advanced-rvest.html"><i class="fa fa-check"></i><b>16</b> Advanced rvest</a>
<ul>
<li class="chapter" data-level="16.1" data-path="advanced-rvest.html"><a href="advanced-rvest.html#using-for-loops"><i class="fa fa-check"></i><b>16.1</b> Using for loops</a></li>
<li class="chapter" data-level="16.2" data-path="advanced-rvest.html"><a href="advanced-rvest.html#looping-and-rvest"><i class="fa fa-check"></i><b>16.2</b> Looping and rvest</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html"><i class="fa fa-check"></i><b>17</b> Intro to APIs: The Census</a>
<ul>
<li class="chapter" data-level="17.1" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html#the-acs"><i class="fa fa-check"></i><b>17.1</b> The ACS</a></li>
<li class="chapter" data-level="17.2" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html#wide-results"><i class="fa fa-check"></i><b>17.2</b> “Wide” Results</a></li>
<li class="chapter" data-level="17.3" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html#sorting-results"><i class="fa fa-check"></i><b>17.3</b> Sorting Results</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="visualizing-your-data-for-reporting.html"><a href="visualizing-your-data-for-reporting.html"><i class="fa fa-check"></i><b>18</b> Visualizing your data for reporting</a>
<ul>
<li class="chapter" data-level="18.1" data-path="visualizing-your-data-for-reporting.html"><a href="visualizing-your-data-for-reporting.html#bar-charts"><i class="fa fa-check"></i><b>18.1</b> Bar charts</a></li>
<li class="chapter" data-level="18.2" data-path="visualizing-your-data-for-reporting.html"><a href="visualizing-your-data-for-reporting.html#line-charts"><i class="fa fa-check"></i><b>18.2</b> Line charts</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="visualizing-your-data-for-publication.html"><a href="visualizing-your-data-for-publication.html"><i class="fa fa-check"></i><b>19</b> Visualizing your data for publication</a>
<ul>
<li class="chapter" data-level="19.1" data-path="visualizing-your-data-for-publication.html"><a href="visualizing-your-data-for-publication.html#datawrapper"><i class="fa fa-check"></i><b>19.1</b> Datawrapper</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="visualizing-your-data-for-publication.html"><a href="visualizing-your-data-for-publication.html#making-a-map"><i class="fa fa-check"></i><b>19.1.1</b> Making a Map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="geographic-data-basics.html"><a href="geographic-data-basics.html"><i class="fa fa-check"></i><b>20</b> Geographic data basics</a>
<ul>
<li class="chapter" data-level="20.1" data-path="geographic-data-basics.html"><a href="geographic-data-basics.html#importing-and-viewing-data"><i class="fa fa-check"></i><b>20.1</b> Importing and viewing data</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="geographic-analysis.html"><a href="geographic-analysis.html"><i class="fa fa-check"></i><b>21</b> Geographic analysis</a></li>
<li class="chapter" data-level="22" data-path="automating-analysis.html"><a href="automating-analysis.html"><i class="fa fa-check"></i><b>22</b> Automating analysis</a>
<ul>
<li class="chapter" data-level="22.1" data-path="automating-analysis.html"><a href="automating-analysis.html#automating-downloads-and-imports"><i class="fa fa-check"></i><b>22.1</b> Automating downloads and imports</a></li>
<li class="chapter" data-level="22.2" data-path="automating-analysis.html"><a href="automating-analysis.html#exploring-the-data"><i class="fa fa-check"></i><b>22.2</b> Exploring the data</a></li>
<li class="chapter" data-level="22.3" data-path="automating-analysis.html"><a href="automating-analysis.html#analysis"><i class="fa fa-check"></i><b>22.3</b> Analysis</a></li>
<li class="chapter" data-level="22.4" data-path="automating-analysis.html"><a href="automating-analysis.html#making-updating-graphics"><i class="fa fa-check"></i><b>22.4</b> Making updating graphics</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="automating-geographic-analysis.html"><a href="automating-geographic-analysis.html"><i class="fa fa-check"></i><b>23</b> Automating geographic analysis</a>
<ul>
<li class="chapter" data-level="23.1" data-path="automating-geographic-analysis.html"><a href="automating-geographic-analysis.html#mapping-continuously"><i class="fa fa-check"></i><b>23.1</b> Mapping continuously</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="basic-stats-linear-regression-and-the-t-test.html"><a href="basic-stats-linear-regression-and-the-t-test.html"><i class="fa fa-check"></i><b>24</b> Basic Stats: Linear Regression and The T-Test</a></li>
<li class="chapter" data-level="25" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>25</b> Linear Regression</a></li>
<li class="chapter" data-level="26" data-path="t-tests.html"><a href="t-tests.html"><i class="fa fa-check"></i><b>26</b> T-tests</a></li>
<li class="chapter" data-level="27" data-path="an-intro-to-text-analysis.html"><a href="an-intro-to-text-analysis.html"><i class="fa fa-check"></i><b>27</b> An intro to text analysis</a>
<ul>
<li class="chapter" data-level="27.1" data-path="an-intro-to-text-analysis.html"><a href="an-intro-to-text-analysis.html#going-beyond-a-single-word"><i class="fa fa-check"></i><b>27.1</b> Going beyond a single word</a></li>
<li class="chapter" data-level="27.2" data-path="an-intro-to-text-analysis.html"><a href="an-intro-to-text-analysis.html#sentiment-analysis"><i class="fa fa-check"></i><b>27.2</b> Sentiment Analysis</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html"><i class="fa fa-check"></i><b>28</b> Writing with numbers</a>
<ul>
<li class="chapter" data-level="28.1" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html#how-to-write-about-numbers-without-overwhelming-with-numbers."><i class="fa fa-check"></i><b>28.1</b> How to write about numbers without overwhelming with numbers.</a></li>
<li class="chapter" data-level="28.2" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html#when-exact-numbers-matter"><i class="fa fa-check"></i><b>28.2</b> When exact numbers matter</a></li>
<li class="chapter" data-level="28.3" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html#an-example"><i class="fa fa-check"></i><b>28.3</b> An example</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html"><i class="fa fa-check"></i><b>29</b> Ethics in data journalism</a>
<ul>
<li class="chapter" data-level="29.1" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#problems"><i class="fa fa-check"></i><b>29.1</b> Problems</a></li>
<li class="chapter" data-level="29.2" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#the-googlebot"><i class="fa fa-check"></i><b>29.2</b> The Googlebot</a></li>
<li class="chapter" data-level="29.3" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#data-lifetimes"><i class="fa fa-check"></i><b>29.3</b> Data Lifetimes</a></li>
<li class="chapter" data-level="29.4" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#you-are-a-data-provider"><i class="fa fa-check"></i><b>29.4</b> You Are a Data Provider</a></li>
<li class="chapter" data-level="29.5" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#ethical-data"><i class="fa fa-check"></i><b>29.5</b> Ethical Data</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="using-github.html"><a href="using-github.html"><i class="fa fa-check"></i><b>30</b> Using GitHub</a>
<ul>
<li class="chapter" data-level="30.1" data-path="using-github.html"><a href="using-github.html#how-it-works"><i class="fa fa-check"></i><b>30.1</b> How It Works</a></li>
<li class="chapter" data-level="30.2" data-path="using-github.html"><a href="using-github.html#getting-started"><i class="fa fa-check"></i><b>30.2</b> Getting Started</a></li>
<li class="chapter" data-level="30.3" data-path="using-github.html"><a href="using-github.html#advanced-use"><i class="fa fa-check"></i><b>30.3</b> Advanced Use</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Journalism with R and the Tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-rvest" class="section level1" number="16">
<h1><span class="header-section-number">Chapter 16</span> Advanced rvest</h1>
<p>In the last chapter, we demonstrated a fairly straightforward example of web scraping to grab a list of NAICS industry sector codes from the BLS website.</p>
<p>We’re going to graduate to a more challenging example, one that will help us gather information about the number of employees in each industry sector.</p>
<p>What makes this more challenging? Well, the information we need is all contained on multiple pages, one page per sector. We need to write code to visit each page, and then merge them into a single data frame.</p>
<p>This is challenging stuff, so don’t feel dissuaded if it all doesn’t click the first time through. Like many things, web scraping is something that gets easier with lots of practice.</p>
<p>First we start with libraries, as we always do.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="advanced-rvest.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb224-2"><a href="advanced-rvest.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb224-3"><a href="advanced-rvest.html#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code></pre></div>
<p>Now, let’s run the code we wrote in the last chapter, to get a tidy list of NAICS sector codes and names from <a href="%22https://www.bls.gov/ces/naics/%22">https://www.bls.gov/ces/naics/</a>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="advanced-rvest.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of page we want to scrape</span></span>
<span id="cb225-2"><a href="advanced-rvest.html#cb225-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-3"><a href="advanced-rvest.html#cb225-3" aria-hidden="true" tabindex="-1"></a>naics_url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/ces/naics/&quot;</span></span>
<span id="cb225-4"><a href="advanced-rvest.html#cb225-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-5"><a href="advanced-rvest.html#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in all html from table, store all tables on page as nested list of dataframes.</span></span>
<span id="cb225-6"><a href="advanced-rvest.html#cb225-6" aria-hidden="true" tabindex="-1"></a>naics_industry  <span class="ot">&lt;-</span> naics_url <span class="sc">%&gt;%</span></span>
<span id="cb225-7"><a href="advanced-rvest.html#cb225-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb225-8"><a href="advanced-rvest.html#cb225-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb225-9"><a href="advanced-rvest.html#cb225-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-10"><a href="advanced-rvest.html#cb225-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Just keep the second dataframe in our list, standardize column headers, remove last row</span></span>
<span id="cb225-11"><a href="advanced-rvest.html#cb225-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-12"><a href="advanced-rvest.html#cb225-12" aria-hidden="true" tabindex="-1"></a>naics_industry <span class="ot">&lt;-</span> naics_industry[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb225-13"><a href="advanced-rvest.html#cb225-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb225-14"><a href="advanced-rvest.html#cb225-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">21</span>)</span>
<span id="cb225-15"><a href="advanced-rvest.html#cb225-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-16"><a href="advanced-rvest.html#cb225-16" aria-hidden="true" tabindex="-1"></a><span class="co"># show the dataframe</span></span>
<span id="cb225-17"><a href="advanced-rvest.html#cb225-17" aria-hidden="true" tabindex="-1"></a>naics_industry</span></code></pre></div>
<pre><code>## # A tibble: 20 x 2
##    sector description                                                           
##    &lt;chr&gt;  &lt;chr&gt;                                                                 
##  1 11     Agriculture, Forestry, Fishing and Hunting                            
##  2 21     Mining, Quarrying, and Oil and Gas Extraction                         
##  3 22     Utilities                                                             
##  4 23     Construction                                                          
##  5 31-33  Manufacturing                                                         
##  6 42     Wholesale Trade                                                       
##  7 44-45  Retail Trade                                                          
##  8 48-49  Transportation and Warehousing                                        
##  9 51     Information                                                           
## 10 52     Finance and Insurance                                                 
## 11 53     Real Estate and Rental and Leasing                                    
## 12 54     Professional, Scientific, and Technical Services                      
## 13 55     Management of Companies and Enterprises                               
## 14 56     Administrative and Support and Waste Management and Remediation Servi…
## 15 61     Educational Services                                                  
## 16 62     Health Care and Social Assistance                                     
## 17 71     Arts, Entertainment, and Recreation                                   
## 18 72     Accommodation and Food Services                                       
## 19 81     Other Services (except Public Administration)                         
## 20 92     Public Administration</code></pre>
<p>We’ll use this table to help us get to our end goal: a single dataframe with the number of employees in each industry sector.</p>
<p>It will look like this when we’re done.</p>
<p><img src="images/advrvest1a.png" /><!-- --></p>
<p>Unfortunately, that information doesn’t exist in a single tidy table on a single page we can scrape all at once. We’re going to have to scrape it from lots of different pages, and build it ourselves.</p>
<p>Let’s next take a look at the web page that has detailed employment information for one of our sectors, 22, Mining, Quarrying, and Oil and Gas Extraction.</p>
<p>We can find it here: <a href="https://www.bls.gov/iag/tgs/iag22.htm">https://www.bls.gov/iag/tgs/iag22.htm</a>.</p>
<p>A few scrolls down the page, there’s a table that has employee statistics.</p>
<p>The table is called “Employment and Unemployment.” There’s a row in the tabled for “Employment, all employees (seasonally adjusted).” And in that row, there’s a value for the number of employees – in thousands – in June 2021.</p>
<p>The table shows that for the mining sector, it was 538.6 – or 538,600 – in June 2021. That’s the value we want to ingest in R.</p>
<p><img src="images/advrvest1.png" /><!-- --></p>
<p>We don’t just want it for mining. We want it for all sectors!</p>
<p>But we’ll start by writing code just to get it from this one sector page, then modify that code to get it from every sector’s page</p>
<p>First, let’s define the URL of the page we want to get the information from.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="advanced-rvest.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of the page we want to get</span></span>
<span id="cb227-2"><a href="advanced-rvest.html#cb227-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/iag/tgs/iag22.htm&quot;</span></span></code></pre></div>
<p>Next, let’s read in the html of that page, and store it as an object called employment_info.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="advanced-rvest.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of the page we want to get</span></span>
<span id="cb228-2"><a href="advanced-rvest.html#cb228-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/iag/tgs/iag22.htm&quot;</span></span>
<span id="cb228-3"><a href="advanced-rvest.html#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="advanced-rvest.html#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get employment html</span></span>
<span id="cb228-5"><a href="advanced-rvest.html#cb228-5" aria-hidden="true" tabindex="-1"></a>employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb228-6"><a href="advanced-rvest.html#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>()  </span>
<span id="cb228-7"><a href="advanced-rvest.html#cb228-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-8"><a href="advanced-rvest.html#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it so we can see what it looks like</span></span>
<span id="cb228-9"><a href="advanced-rvest.html#cb228-9" aria-hidden="true" tabindex="-1"></a>employment_info</span></code></pre></div>
<pre><code>## {html_document}
## &lt;html lang=&quot;en&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body&gt;\r\n&lt;!-- ****************************************** Begin HEADER ** ...</code></pre>
<p>Now, let’s set to picking out the information we need from the raw html.</p>
<p>We can use the web inspector in our web browser (Chrome) to figure out where the table is located.</p>
<p>Go to the web page and right click on the word “Data Series” in the table, then pick “inspect” to pull up the menu.</p>
<p>Notice two things. First, all of this information is contained in a proper html <code>&lt;table&gt;</code>. And that table has an id property of “iag22emp1.” Designers use these IDs to help style the page, to target certain elements with CSS. We can use it to scrape.</p>
<p><img src="images/advrvest2.png" /><!-- -->
Recall that in the last chapter, when we used the html_table() function, it pulled in every single table on the page, six in total.</p>
<p>Here, we can use that id property to pick out just the table we want, and leave all the others behind.
We do that with a new function from rvest called html_element(), employing a bit of information about that element stored in what’s called the <a href="https://en.wikipedia.org/wiki/XPath">xpath</a>. Xpath is a query language that helps us write programs that target specific parts of web pages.</p>
<p>The syntax is a little unwieldy, I know.</p>
<p>But essentially what the html_element function says is “find the html element that has an id of iag22emp1, using the xpath method, and get rid of all other elements.”</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="advanced-rvest.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of the page we want to get</span></span>
<span id="cb230-2"><a href="advanced-rvest.html#cb230-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/iag/tgs/iag22.htm&quot;</span></span>
<span id="cb230-3"><a href="advanced-rvest.html#cb230-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-4"><a href="advanced-rvest.html#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get employment html page and select only the table with employment information</span></span>
<span id="cb230-5"><a href="advanced-rvest.html#cb230-5" aria-hidden="true" tabindex="-1"></a>employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb230-6"><a href="advanced-rvest.html#cb230-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb230-7"><a href="advanced-rvest.html#cb230-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="at">xpath =</span> <span class="st">&#39;//*[@id=&quot;iag22emp1&quot;]&#39;</span>)</span>
<span id="cb230-8"><a href="advanced-rvest.html#cb230-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-9"><a href="advanced-rvest.html#cb230-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it so we can see what it looks like</span></span>
<span id="cb230-10"><a href="advanced-rvest.html#cb230-10" aria-hidden="true" tabindex="-1"></a>employment_info</span></code></pre></div>
<pre><code>## {html_node}
## &lt;table class=&quot;regular&quot; id=&quot;iag22emp1&quot;&gt;
## [1] &lt;caption&gt;&lt;span class=&quot;tableTitle&quot;&gt;&lt;/span&gt;&lt;/caption&gt;
## [2] &lt;thead&gt;&lt;tr&gt;\n&lt;th class=&quot;stubhead&quot; id=&quot;iag22emp1.h.1.1&quot;&gt;Data series&lt;/th&gt;\r ...
## [3] &lt;tbody&gt;\n&lt;tr&gt;\n&lt;th headers=&quot;iag22emp1.h.1.1&quot; id=&quot;iag22emp1.r.1&quot;&gt;&lt;p class= ...
## [4] &lt;tfoot&gt;&lt;tr class=&quot;footnotes&quot;&gt;\n&lt;td class=&quot;footnotes&quot; colspan=&quot;6&quot;&gt;\r\n\t&lt;p ...</code></pre>
<p>We’ve now isolated the table on the page that contains the information we need, and gotten rid of everything else.</p>
<p>From here, we can use the html_tables() function to transform it from messy html code to a proper dataframe.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="advanced-rvest.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of the page we want to get</span></span>
<span id="cb232-2"><a href="advanced-rvest.html#cb232-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/iag/tgs/iag22.htm&quot;</span></span>
<span id="cb232-3"><a href="advanced-rvest.html#cb232-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-4"><a href="advanced-rvest.html#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get employment html page and select only the table with employment information, then transform it from html to a table.</span></span>
<span id="cb232-5"><a href="advanced-rvest.html#cb232-5" aria-hidden="true" tabindex="-1"></a>employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb232-6"><a href="advanced-rvest.html#cb232-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb232-7"><a href="advanced-rvest.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="at">xpath =</span> <span class="st">&#39;//*[@id=&quot;iag22emp1&quot;]&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-8"><a href="advanced-rvest.html#cb232-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() </span>
<span id="cb232-9"><a href="advanced-rvest.html#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="advanced-rvest.html#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it so we can see what it looks like</span></span>
<span id="cb232-11"><a href="advanced-rvest.html#cb232-11" aria-hidden="true" tabindex="-1"></a>employment_info</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   `Data series`          Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##   &lt;chr&gt;                  &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
## 1 Employment (in thousa… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
## 2 Employment, all emplo… &quot;&quot;          &quot;538.9&quot;    &quot;536.7&quot;    &quot;(p)536.5&quot; &quot;(p)536.7&quot;
## 3 Employment, productio… &quot;&quot;          &quot;429.1&quot;    &quot;426.9&quot;    &quot;(p)426.8&quot; &quot;(p)427.4&quot;
## 4 Unemployment           &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
## 5 Unemployment rate      &quot;&quot;          &quot;3.4%&quot;     &quot;2.7%&quot;     &quot;3.1%&quot;     &quot;1.8%&quot;    
## 6 Footnotes(p) Prelimin… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…</code></pre>
<p>Now we have a proper dataframe of 6 rows and 6 columns.</p>
<p>It has much more information than we need, so let’s clean it up to isolate only the “Employment, all employees (seasonally adjusted)” value for June 2021.</p>
<p>Use clean_names() to standardize the column names, use slice() to keep only the second row, and use select() to keep two columns data_series and jul_2021.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="advanced-rvest.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of the page we want to get</span></span>
<span id="cb234-2"><a href="advanced-rvest.html#cb234-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/iag/tgs/iag21.htm&quot;</span></span>
<span id="cb234-3"><a href="advanced-rvest.html#cb234-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-4"><a href="advanced-rvest.html#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get employment html page and select only the table with employment information, then transform it from html to a table.</span></span>
<span id="cb234-5"><a href="advanced-rvest.html#cb234-5" aria-hidden="true" tabindex="-1"></a>employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb234-6"><a href="advanced-rvest.html#cb234-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb234-7"><a href="advanced-rvest.html#cb234-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="at">xpath =</span> <span class="st">&#39;//*[@id=&quot;iag21emp1&quot;]&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb234-8"><a href="advanced-rvest.html#cb234-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() </span>
<span id="cb234-9"><a href="advanced-rvest.html#cb234-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-10"><a href="advanced-rvest.html#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only second row with seasonally adjusted, bind back to each_row_df</span></span>
<span id="cb234-11"><a href="advanced-rvest.html#cb234-11" aria-hidden="true" tabindex="-1"></a>employment_info <span class="ot">&lt;-</span> employment_info <span class="sc">%&gt;%</span></span>
<span id="cb234-12"><a href="advanced-rvest.html#cb234-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb234-13"><a href="advanced-rvest.html#cb234-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb234-14"><a href="advanced-rvest.html#cb234-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(data_series, jul_2021)</span>
<span id="cb234-15"><a href="advanced-rvest.html#cb234-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-16"><a href="advanced-rvest.html#cb234-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it so we can see what it looks like</span></span>
<span id="cb234-17"><a href="advanced-rvest.html#cb234-17" aria-hidden="true" tabindex="-1"></a>employment_info</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   data_series                                      jul_2021
##   &lt;chr&gt;                                            &lt;chr&gt;   
## 1 Employment, all employees  (seasonally adjusted) 592.5</code></pre>
<p>Okay, so we’ve successfully obtained the employment numbers for one of our sectors. That’s great.</p>
<p>But remember our original charge: to get a table with employment numbers for ALL sectors, not just one.</p>
<p>This is a little tricky, because, remember, the information for each sector is on a different page!</p>
<p>The info for mining is on this page: <a href="https://www.bls.gov/iag/tgs/iag21.htm">https://www.bls.gov/iag/tgs/iag21.htm</a>.</p>
<p>The info for construction is on this page: <a href="https://www.bls.gov/iag/tgs/iag23.htm">https://www.bls.gov/iag/tgs/iag23.htm</a>.</p>
<p>We have 20 sectors to get through.</p>
<p>We could get the info we need by copying the codeblock we just wrote 20 times, and change the url at the top each time.</p>
<p>But that’s not a great approach.</p>
<p>What if we needed to change the code? We’d need to change it 20 times!</p>
<p>In programming, there’s a principle called “DRY” which stands for “Don’t Repeat Yourself.” If you find yourself copying the same code over and over again, with minor changes, it’s better to find a way to avoid that.</p>
<div id="using-for-loops" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Using for loops</h2>
<p>Fortunately, there’s a programming paradigm called “iteration” that is helpful here, using a method called a “for loop.”</p>
<p>Every programming language has its own version of a “for loop,” and R is no different.</p>
<p>A “for loop” says: “let’s take a list of things, and do the same thing to each item on that list.”</p>
<p>Let’s look at a very simple example to help illustrate the values of for loops.</p>
<p>We’re going to write code to print out 10 industry sectors.</p>
<p>First, let’s do it the repetitive way. We’re writing the same print function over and over, just changing the sector name each time.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="advanced-rvest.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Agriculture, Forestry, Fishing and Hunting&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Agriculture, Forestry, Fishing and Hunting&quot;</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="advanced-rvest.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Mining, Quarrying, and Oil and Gas Extraction&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Mining, Quarrying, and Oil and Gas Extraction&quot;</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="advanced-rvest.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Utilities&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Utilities&quot;</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="advanced-rvest.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Construction&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Construction&quot;</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="advanced-rvest.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Manufacturing&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Manufacturing&quot;</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="advanced-rvest.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Wholesale Trade&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Wholesale Trade&quot;</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="advanced-rvest.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Retail Trade&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Retail Trade&quot;</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="advanced-rvest.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Transportation and Warehousing&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Transportation and Warehousing&quot;</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="advanced-rvest.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Information&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Information&quot;</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="advanced-rvest.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Finance and Insurance&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Finance and Insurance&quot;</code></pre>
<p>We repeated print() 10 times, with minor modifications each time. Lots of repetition, which we seek to avoid if possible.</p>
<p>Now let’s look at how we might do that a little more efficiently with a “for loop.”</p>
<p>First let’s make a list of sectors, and save it as an object called “list_of_sectors.” The c() function tells R that we’re making a list.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="advanced-rvest.html#cb256-1" aria-hidden="true" tabindex="-1"></a>list_of_sectors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Agriculture, Forestry, Fishing and Hunting&quot;</span>, <span class="st">&quot;Mining, Quarrying, and Oil and Gas Extraction&quot;</span>, <span class="st">&quot;Utilities&quot;</span>, <span class="st">&quot;Construction&quot;</span>, <span class="st">&quot;Manufacturing&quot;</span>,</span>
<span id="cb256-2"><a href="advanced-rvest.html#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Wholesale Trade&quot;</span>, <span class="st">&quot;Retail Trade&quot;</span>, <span class="st">&quot;Transportation and Warehousing&quot;</span>, <span class="st">&quot;Information&quot;</span>, <span class="st">&quot;Finance and Insurance&quot;</span>)</span></code></pre></div>
<p>And now let’s write a “for loop” to print out sector on that list.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="advanced-rvest.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define list of sectors</span></span>
<span id="cb257-2"><a href="advanced-rvest.html#cb257-2" aria-hidden="true" tabindex="-1"></a>list_of_sectors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Agriculture, Forestry, Fishing and Hunting&quot;</span>, <span class="st">&quot;Mining, Quarrying, and Oil and Gas Extraction&quot;</span>, <span class="st">&quot;Utilities&quot;</span>, <span class="st">&quot;Construction&quot;</span>, <span class="st">&quot;Manufacturing&quot;</span>,</span>
<span id="cb257-3"><a href="advanced-rvest.html#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Wholesale Trade&quot;</span>, <span class="st">&quot;Retail Trade&quot;</span>, <span class="st">&quot;Transportation and Warehousing&quot;</span>, <span class="st">&quot;Information&quot;</span>, <span class="st">&quot;Finance and Insurance&quot;</span>)</span>
<span id="cb257-4"><a href="advanced-rvest.html#cb257-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-5"><a href="advanced-rvest.html#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a for loop and run it</span></span>
<span id="cb257-6"><a href="advanced-rvest.html#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sector <span class="cf">in</span> list_of_sectors) {</span>
<span id="cb257-7"><a href="advanced-rvest.html#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sector)</span>
<span id="cb257-8"><a href="advanced-rvest.html#cb257-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Agriculture, Forestry, Fishing and Hunting&quot;
## [1] &quot;Mining, Quarrying, and Oil and Gas Extraction&quot;
## [1] &quot;Utilities&quot;
## [1] &quot;Construction&quot;
## [1] &quot;Manufacturing&quot;
## [1] &quot;Wholesale Trade&quot;
## [1] &quot;Retail Trade&quot;
## [1] &quot;Transportation and Warehousing&quot;
## [1] &quot;Information&quot;
## [1] &quot;Finance and Insurance&quot;</code></pre>
<p>That’s many fewer lines of code. Let’s break down what we just saw, starting with for <code>(sector in list_of sectors)</code>.</p>
<p>The information inside the parentheses tells R what list to use – list_of_sectors – and how to identify list elements later on – sector.</p>
<p>It’s important that the thing on the right side of “in” use the exact name of the list we want to loop through – in this case “list_of_sectors.”</p>
<p>If we try to feed it something different – say “sector_list” – it won’t work, because our actual list is called something else – “list_of_sectors.” This code throws an error.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="advanced-rvest.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define list of sectors</span></span>
<span id="cb259-2"><a href="advanced-rvest.html#cb259-2" aria-hidden="true" tabindex="-1"></a>list_of_sectors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Agriculture, Forestry, Fishing and Hunting&quot;</span>, <span class="st">&quot;Mining, Quarrying, and Oil and Gas Extraction&quot;</span>, <span class="st">&quot;Utilities&quot;</span>, <span class="st">&quot;Construction&quot;</span>, <span class="st">&quot;Manufacturing&quot;</span>,</span>
<span id="cb259-3"><a href="advanced-rvest.html#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Wholesale Trade&quot;</span>, <span class="st">&quot;Retail Trade&quot;</span>, <span class="st">&quot;Transportation and Warehousing&quot;</span>, <span class="st">&quot;Information&quot;</span>, <span class="st">&quot;Finance and Insurance&quot;</span>)</span>
<span id="cb259-4"><a href="advanced-rvest.html#cb259-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-5"><a href="advanced-rvest.html#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that refers to a list that doesn&#39;t exist!  </span></span>
<span id="cb259-6"><a href="advanced-rvest.html#cb259-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sector <span class="cf">in</span> sector_list) {</span>
<span id="cb259-7"><a href="advanced-rvest.html#cb259-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sector)</span>
<span id="cb259-8"><a href="advanced-rvest.html#cb259-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;sector_list&#39; not found</code></pre>
<p>The name on the left side of “in” – the word we’re assigning to represent each element – is totally arbitrary.</p>
<p>We could use any character string, even something simple like “x.”</p>
<p>What matters is that we use the same character string inside of the curly braces {}, the section of the “for loop” that tells R what to do to each element – in this case, print it out.</p>
<p>To illustrate this, note that the code works just fine if we change it to say this:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="advanced-rvest.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define list of sectors</span></span>
<span id="cb261-2"><a href="advanced-rvest.html#cb261-2" aria-hidden="true" tabindex="-1"></a>list_of_sectors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Agriculture, Forestry, Fishing and Hunting&quot;</span>, <span class="st">&quot;Mining, Quarrying, and Oil and Gas Extraction&quot;</span>, <span class="st">&quot;Utilities&quot;</span>, <span class="st">&quot;Construction&quot;</span>, <span class="st">&quot;Manufacturing&quot;</span>,</span>
<span id="cb261-3"><a href="advanced-rvest.html#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Wholesale Trade&quot;</span>, <span class="st">&quot;Retail Trade&quot;</span>, <span class="st">&quot;Transportation and Warehousing&quot;</span>, <span class="st">&quot;Information&quot;</span>, <span class="st">&quot;Finance and Insurance&quot;</span>)</span>
<span id="cb261-4"><a href="advanced-rvest.html#cb261-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-5"><a href="advanced-rvest.html#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop with x that stands in for each element in our list, instead of sector </span></span>
<span id="cb261-6"><a href="advanced-rvest.html#cb261-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> list_of_sectors) {</span>
<span id="cb261-7"><a href="advanced-rvest.html#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x)</span>
<span id="cb261-8"><a href="advanced-rvest.html#cb261-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Agriculture, Forestry, Fishing and Hunting&quot;
## [1] &quot;Mining, Quarrying, and Oil and Gas Extraction&quot;
## [1] &quot;Utilities&quot;
## [1] &quot;Construction&quot;
## [1] &quot;Manufacturing&quot;
## [1] &quot;Wholesale Trade&quot;
## [1] &quot;Retail Trade&quot;
## [1] &quot;Transportation and Warehousing&quot;
## [1] &quot;Information&quot;
## [1] &quot;Finance and Insurance&quot;</code></pre>
<p>But it does NOT work if we call each element one thing – x – in the first line of our “for loop,” and use a different name to refer to it inside of the curly braces.</p>
<p>In this code below, it has no idea what we mean by “sector_name,” because we haven’t defined that anywhere.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="advanced-rvest.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define list of sectors</span></span>
<span id="cb263-2"><a href="advanced-rvest.html#cb263-2" aria-hidden="true" tabindex="-1"></a>list_of_sectors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Agriculture, Forestry, Fishing and Hunting&quot;</span>, <span class="st">&quot;Mining, Quarrying, and Oil and Gas Extraction&quot;</span>, <span class="st">&quot;Utilities&quot;</span>, <span class="st">&quot;Construction&quot;</span>, <span class="st">&quot;Manufacturing&quot;</span>,</span>
<span id="cb263-3"><a href="advanced-rvest.html#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Wholesale Trade&quot;</span>, <span class="st">&quot;Retail Trade&quot;</span>, <span class="st">&quot;Transportation and Warehousing&quot;</span>, <span class="st">&quot;Information&quot;</span>, <span class="st">&quot;Finance and Insurance&quot;</span>)</span>
<span id="cb263-4"><a href="advanced-rvest.html#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="advanced-rvest.html#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that includes instructions that refer to a variable that doesn&#39;t exist.</span></span>
<span id="cb263-6"><a href="advanced-rvest.html#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> list_of_sectors) {</span>
<span id="cb263-7"><a href="advanced-rvest.html#cb263-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sector_name)</span>
<span id="cb263-8"><a href="advanced-rvest.html#cb263-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Error in print(sector_name): object &#39;sector_name&#39; not found</code></pre>
<p>We can also write for loops to iterate over a range of numbers, instead of a list of characters. The syntax is a little different.</p>
<p>The code below says: “for each number in a range of numbers from 1 to 10, print the number.”</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="advanced-rvest.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that includes instructions that refer to a variable that doesn&#39;t exist.</span></span>
<span id="cb265-2"><a href="advanced-rvest.html#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb265-3"><a href="advanced-rvest.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(number)</span>
<span id="cb265-4"><a href="advanced-rvest.html#cb265-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10</code></pre>
<p>Here’s a minor variation on that approach that we’ll make use of below.</p>
<p>Instead of giving the for loop an explicit number range, like 1:10, we can tell it to use 1 to “the number of rows in a dataframe” as our list of things to loop through.</p>
<p>Remember the naics_industry dataframe we loaded first? It has 20 rows.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="advanced-rvest.html#cb267-1" aria-hidden="true" tabindex="-1"></a>naics_industry</span></code></pre></div>
<pre><code>## # A tibble: 20 x 2
##    sector description                                                           
##    &lt;chr&gt;  &lt;chr&gt;                                                                 
##  1 11     Agriculture, Forestry, Fishing and Hunting                            
##  2 21     Mining, Quarrying, and Oil and Gas Extraction                         
##  3 22     Utilities                                                             
##  4 23     Construction                                                          
##  5 31-33  Manufacturing                                                         
##  6 42     Wholesale Trade                                                       
##  7 44-45  Retail Trade                                                          
##  8 48-49  Transportation and Warehousing                                        
##  9 51     Information                                                           
## 10 52     Finance and Insurance                                                 
## 11 53     Real Estate and Rental and Leasing                                    
## 12 54     Professional, Scientific, and Technical Services                      
## 13 55     Management of Companies and Enterprises                               
## 14 56     Administrative and Support and Waste Management and Remediation Servi…
## 15 61     Educational Services                                                  
## 16 62     Health Care and Social Assistance                                     
## 17 71     Arts, Entertainment, and Recreation                                   
## 18 72     Accommodation and Food Services                                       
## 19 81     Other Services (except Public Administration)                         
## 20 92     Public Administration</code></pre>
<p>We can use that information in our for loop by using the nrow() function, which calculates the number of rows in a dataframe. Here’s a quick demonstration of how that works.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="advanced-rvest.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(naics_industry)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<p>To put it all together, the code below says “make a list of numbers that starts at 1 and ends at the number of rows in the naics_industry dataframe (which is 20), then print out each of these numbers.”</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="advanced-rvest.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that includes instructions that refer to a variable that doesn&#39;t exist.</span></span>
<span id="cb271-2"><a href="advanced-rvest.html#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb271-3"><a href="advanced-rvest.html#cb271-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(row_number)</span>
<span id="cb271-4"><a href="advanced-rvest.html#cb271-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
## [1] 11
## [1] 12
## [1] 13
## [1] 14
## [1] 15
## [1] 16
## [1] 17
## [1] 18
## [1] 19
## [1] 20</code></pre>
<p>These were basic examples of how “for loops” work. Next, we’ll learn to apply “for loops” to efficentily extract information from multiple web pages.</p>
</div>
<div id="looping-and-rvest" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> Looping and rvest</h2>
<p>First, let’s look at the codeblock we wrote earlier to extract the number of employees in the mining sector.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="advanced-rvest.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of the page we want to get</span></span>
<span id="cb273-2"><a href="advanced-rvest.html#cb273-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/iag/tgs/iag21.htm&quot;</span></span>
<span id="cb273-3"><a href="advanced-rvest.html#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="advanced-rvest.html#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get employment html page and select only the table with employment information, then transform it from html to a table.</span></span>
<span id="cb273-5"><a href="advanced-rvest.html#cb273-5" aria-hidden="true" tabindex="-1"></a>employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb273-6"><a href="advanced-rvest.html#cb273-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb273-7"><a href="advanced-rvest.html#cb273-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="at">xpath =</span> <span class="st">&#39;//*[@id=&quot;iag21emp1&quot;]&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb273-8"><a href="advanced-rvest.html#cb273-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() </span>
<span id="cb273-9"><a href="advanced-rvest.html#cb273-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-10"><a href="advanced-rvest.html#cb273-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only second row with seasonally adjusted, bind back to each_row_df</span></span>
<span id="cb273-11"><a href="advanced-rvest.html#cb273-11" aria-hidden="true" tabindex="-1"></a>employment_info <span class="ot">&lt;-</span> employment_info <span class="sc">%&gt;%</span></span>
<span id="cb273-12"><a href="advanced-rvest.html#cb273-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb273-13"><a href="advanced-rvest.html#cb273-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb273-14"><a href="advanced-rvest.html#cb273-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(data_series, jul_2021)</span>
<span id="cb273-15"><a href="advanced-rvest.html#cb273-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-16"><a href="advanced-rvest.html#cb273-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it so we can see what it looks like</span></span>
<span id="cb273-17"><a href="advanced-rvest.html#cb273-17" aria-hidden="true" tabindex="-1"></a>employment_info</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   data_series                                      jul_2021
##   &lt;chr&gt;                                            &lt;chr&gt;   
## 1 Employment, all employees  (seasonally adjusted) 592.5</code></pre>
<p>This contains all the steps we needed to extract the information from one sector page. We’re now going to modify this function so we can use it to extract information from each sector page, writing code that keeps us from repeating ourselves too much.<br />
First, we need to build a list of URLs to loop through in a “for loop.” We can do that using the dataframe we made in the last chapter.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="advanced-rvest.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define url of page we want to scrape</span></span>
<span id="cb275-2"><a href="advanced-rvest.html#cb275-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-3"><a href="advanced-rvest.html#cb275-3" aria-hidden="true" tabindex="-1"></a>naics_url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bls.gov/ces/naics/&quot;</span></span>
<span id="cb275-4"><a href="advanced-rvest.html#cb275-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-5"><a href="advanced-rvest.html#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in all html from table, store all tables on page as nested list of dataframes.</span></span>
<span id="cb275-6"><a href="advanced-rvest.html#cb275-6" aria-hidden="true" tabindex="-1"></a>naics_industry  <span class="ot">&lt;-</span> naics_url <span class="sc">%&gt;%</span></span>
<span id="cb275-7"><a href="advanced-rvest.html#cb275-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb275-8"><a href="advanced-rvest.html#cb275-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb275-9"><a href="advanced-rvest.html#cb275-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-10"><a href="advanced-rvest.html#cb275-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Just keep the second dataframe in our list, standardize column headers, remove last row</span></span>
<span id="cb275-11"><a href="advanced-rvest.html#cb275-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-12"><a href="advanced-rvest.html#cb275-12" aria-hidden="true" tabindex="-1"></a>naics_industry <span class="ot">&lt;-</span> naics_industry[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb275-13"><a href="advanced-rvest.html#cb275-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb275-14"><a href="advanced-rvest.html#cb275-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">21</span>)</span>
<span id="cb275-15"><a href="advanced-rvest.html#cb275-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-16"><a href="advanced-rvest.html#cb275-16" aria-hidden="true" tabindex="-1"></a><span class="co"># show the dataframe</span></span>
<span id="cb275-17"><a href="advanced-rvest.html#cb275-17" aria-hidden="true" tabindex="-1"></a>naics_industry</span></code></pre></div>
<pre><code>## # A tibble: 20 x 2
##    sector description                                                           
##    &lt;chr&gt;  &lt;chr&gt;                                                                 
##  1 11     Agriculture, Forestry, Fishing and Hunting                            
##  2 21     Mining, Quarrying, and Oil and Gas Extraction                         
##  3 22     Utilities                                                             
##  4 23     Construction                                                          
##  5 31-33  Manufacturing                                                         
##  6 42     Wholesale Trade                                                       
##  7 44-45  Retail Trade                                                          
##  8 48-49  Transportation and Warehousing                                        
##  9 51     Information                                                           
## 10 52     Finance and Insurance                                                 
## 11 53     Real Estate and Rental and Leasing                                    
## 12 54     Professional, Scientific, and Technical Services                      
## 13 55     Management of Companies and Enterprises                               
## 14 56     Administrative and Support and Waste Management and Remediation Servi…
## 15 61     Educational Services                                                  
## 16 62     Health Care and Social Assistance                                     
## 17 71     Arts, Entertainment, and Recreation                                   
## 18 72     Accommodation and Food Services                                       
## 19 81     Other Services (except Public Administration)                         
## 20 92     Public Administration</code></pre>
<p>This gives us the sector code and name for each industry.</p>
<p>Now let’s have a look at the URLs for a few of the pages we want to grab data from.</p>
<ul>
<li>Mining, Quarrying, and Oil and Gas Extraction: <a href="https://www.bls.gov/iag/tgs/iag21.htm">https://www.bls.gov/iag/tgs/iag21.htm</a>.</li>
<li>Utilities: <a href="https://www.bls.gov/iag/tgs/iag22.htm">https://www.bls.gov/iag/tgs/iag22.htm</a>.</li>
<li>Construction: <a href="https://www.bls.gov/iag/tgs/iag23.htm">https://www.bls.gov/iag/tgs/iag23.htm</a></li>
</ul>
<p>Notice a pattern?</p>
<p>They all start with “<a href="https://www.bls.gov/iag/tgs/iag" class="uri">https://www.bls.gov/iag/tgs/iag</a>.” The next bit of information is different for each one; with the two-digit sector code for each sector. The remainder is identical in all three links, “.htm.”</p>
<p>Because they’re all the same, we can use the information in the dataframe we just loaded to make all the URLs we need.</p>
<p>We’re going to use mutate() and paste0() to concatenate (mash together) the things that stay constant in every url (the beginning and end) with the things that are different (the sector number, stored in the column called sector).</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="advanced-rvest.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a column with URL for each sector. </span></span>
<span id="cb277-2"><a href="advanced-rvest.html#cb277-2" aria-hidden="true" tabindex="-1"></a>naics_industry <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb277-3"><a href="advanced-rvest.html#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector_url =</span> <span class="fu">paste0</span>(<span class="st">&quot;https://www.bls.gov/iag/tgs/iag&quot;</span>,sector,<span class="st">&quot;.htm&quot;</span>))</span>
<span id="cb277-4"><a href="advanced-rvest.html#cb277-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-5"><a href="advanced-rvest.html#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it</span></span>
<span id="cb277-6"><a href="advanced-rvest.html#cb277-6" aria-hidden="true" tabindex="-1"></a>naics_industry</span></code></pre></div>
<pre><code>## # A tibble: 20 x 3
##    sector description                                  sector_url               
##    &lt;chr&gt;  &lt;chr&gt;                                        &lt;chr&gt;                    
##  1 11     Agriculture, Forestry, Fishing and Hunting   https://www.bls.gov/iag/…
##  2 21     Mining, Quarrying, and Oil and Gas Extracti… https://www.bls.gov/iag/…
##  3 22     Utilities                                    https://www.bls.gov/iag/…
##  4 23     Construction                                 https://www.bls.gov/iag/…
##  5 31-33  Manufacturing                                https://www.bls.gov/iag/…
##  6 42     Wholesale Trade                              https://www.bls.gov/iag/…
##  7 44-45  Retail Trade                                 https://www.bls.gov/iag/…
##  8 48-49  Transportation and Warehousing               https://www.bls.gov/iag/…
##  9 51     Information                                  https://www.bls.gov/iag/…
## 10 52     Finance and Insurance                        https://www.bls.gov/iag/…
## 11 53     Real Estate and Rental and Leasing           https://www.bls.gov/iag/…
## 12 54     Professional, Scientific, and Technical Ser… https://www.bls.gov/iag/…
## 13 55     Management of Companies and Enterprises      https://www.bls.gov/iag/…
## 14 56     Administrative and Support and Waste Manage… https://www.bls.gov/iag/…
## 15 61     Educational Services                         https://www.bls.gov/iag/…
## 16 62     Health Care and Social Assistance            https://www.bls.gov/iag/…
## 17 71     Arts, Entertainment, and Recreation          https://www.bls.gov/iag/…
## 18 72     Accommodation and Food Services              https://www.bls.gov/iag/…
## 19 81     Other Services (except Public Administratio… https://www.bls.gov/iag/…
## 20 92     Public Administration                        https://www.bls.gov/iag/…</code></pre>
<p>While we’re at it, we’re going to use the same method to programatically build the “xpath” for the table on each sector page.</p>
<p>Recall that when we wrote our function that got information from just the mining page, the xpath targeted an element with an ID of “iag21emp1.” Why 21? That’s the sector code for mining.</p>
<p>If we look for that exact element ID on other sector pages, we won’t find it! That’s because it’s different for each page.</p>
<p>On the Utilities page (sector code 22), the ID for the table we want is “iag22emp1.” On the Construction page (sector code 23), it’s “iag23emp1.” We can also build this programatically, because it follows a predictable pattern.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="advanced-rvest.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a column with URL and xpath ID for each sector</span></span>
<span id="cb279-2"><a href="advanced-rvest.html#cb279-2" aria-hidden="true" tabindex="-1"></a>naics_industry <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb279-3"><a href="advanced-rvest.html#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector_url =</span> <span class="fu">paste0</span>(<span class="st">&quot;https://www.bls.gov/iag/tgs/iag&quot;</span>,sector,<span class="st">&quot;.htm&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb279-4"><a href="advanced-rvest.html#cb279-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector_xpath_id =</span><span class="fu">paste0</span>(<span class="st">&quot;iag&quot;</span>,sector,<span class="st">&quot;emp1&quot;</span>))</span>
<span id="cb279-5"><a href="advanced-rvest.html#cb279-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-6"><a href="advanced-rvest.html#cb279-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it</span></span>
<span id="cb279-7"><a href="advanced-rvest.html#cb279-7" aria-hidden="true" tabindex="-1"></a>naics_industry</span></code></pre></div>
<pre><code>## # A tibble: 20 x 4
##    sector description                       sector_url           sector_xpath_id
##    &lt;chr&gt;  &lt;chr&gt;                             &lt;chr&gt;                &lt;chr&gt;          
##  1 11     Agriculture, Forestry, Fishing a… https://www.bls.gov… iag11emp1      
##  2 21     Mining, Quarrying, and Oil and G… https://www.bls.gov… iag21emp1      
##  3 22     Utilities                         https://www.bls.gov… iag22emp1      
##  4 23     Construction                      https://www.bls.gov… iag23emp1      
##  5 31-33  Manufacturing                     https://www.bls.gov… iag31-33emp1   
##  6 42     Wholesale Trade                   https://www.bls.gov… iag42emp1      
##  7 44-45  Retail Trade                      https://www.bls.gov… iag44-45emp1   
##  8 48-49  Transportation and Warehousing    https://www.bls.gov… iag48-49emp1   
##  9 51     Information                       https://www.bls.gov… iag51emp1      
## 10 52     Finance and Insurance             https://www.bls.gov… iag52emp1      
## 11 53     Real Estate and Rental and Leasi… https://www.bls.gov… iag53emp1      
## 12 54     Professional, Scientific, and Te… https://www.bls.gov… iag54emp1      
## 13 55     Management of Companies and Ente… https://www.bls.gov… iag55emp1      
## 14 56     Administrative and Support and W… https://www.bls.gov… iag56emp1      
## 15 61     Educational Services              https://www.bls.gov… iag61emp1      
## 16 62     Health Care and Social Assistance https://www.bls.gov… iag62emp1      
## 17 71     Arts, Entertainment, and Recreat… https://www.bls.gov… iag71emp1      
## 18 72     Accommodation and Food Services   https://www.bls.gov… iag72emp1      
## 19 81     Other Services (except Public Ad… https://www.bls.gov… iag81emp1      
## 20 92     Public Administration             https://www.bls.gov… iag92emp1</code></pre>
<p>Lastly, we’re going to use filter to remove the “Public Administration” sector, because there’s no page for it. We’ll have to get that information some other way.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="advanced-rvest.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a column with URL and xpath ID for each sector, remove the Public Administration sector</span></span>
<span id="cb281-2"><a href="advanced-rvest.html#cb281-2" aria-hidden="true" tabindex="-1"></a>naics_industry <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb281-3"><a href="advanced-rvest.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector_url =</span> <span class="fu">paste0</span>(<span class="st">&quot;https://www.bls.gov/iag/tgs/iag&quot;</span>,sector,<span class="st">&quot;.htm&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb281-4"><a href="advanced-rvest.html#cb281-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector_xpath_id =</span><span class="fu">paste0</span>(<span class="st">&quot;iag&quot;</span>,sector,<span class="st">&quot;emp1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb281-5"><a href="advanced-rvest.html#cb281-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(description <span class="sc">!=</span> <span class="st">&quot;Public Administration&quot;</span>)</span>
<span id="cb281-6"><a href="advanced-rvest.html#cb281-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display it</span></span>
<span id="cb281-7"><a href="advanced-rvest.html#cb281-7" aria-hidden="true" tabindex="-1"></a>naics_industry</span></code></pre></div>
<pre><code>## # A tibble: 19 x 4
##    sector description                       sector_url           sector_xpath_id
##    &lt;chr&gt;  &lt;chr&gt;                             &lt;chr&gt;                &lt;chr&gt;          
##  1 11     Agriculture, Forestry, Fishing a… https://www.bls.gov… iag11emp1      
##  2 21     Mining, Quarrying, and Oil and G… https://www.bls.gov… iag21emp1      
##  3 22     Utilities                         https://www.bls.gov… iag22emp1      
##  4 23     Construction                      https://www.bls.gov… iag23emp1      
##  5 31-33  Manufacturing                     https://www.bls.gov… iag31-33emp1   
##  6 42     Wholesale Trade                   https://www.bls.gov… iag42emp1      
##  7 44-45  Retail Trade                      https://www.bls.gov… iag44-45emp1   
##  8 48-49  Transportation and Warehousing    https://www.bls.gov… iag48-49emp1   
##  9 51     Information                       https://www.bls.gov… iag51emp1      
## 10 52     Finance and Insurance             https://www.bls.gov… iag52emp1      
## 11 53     Real Estate and Rental and Leasi… https://www.bls.gov… iag53emp1      
## 12 54     Professional, Scientific, and Te… https://www.bls.gov… iag54emp1      
## 13 55     Management of Companies and Ente… https://www.bls.gov… iag55emp1      
## 14 56     Administrative and Support and W… https://www.bls.gov… iag56emp1      
## 15 61     Educational Services              https://www.bls.gov… iag61emp1      
## 16 62     Health Care and Social Assistance https://www.bls.gov… iag62emp1      
## 17 71     Arts, Entertainment, and Recreat… https://www.bls.gov… iag71emp1      
## 18 72     Accommodation and Food Services   https://www.bls.gov… iag72emp1      
## 19 81     Other Services (except Public Ad… https://www.bls.gov… iag81emp1</code></pre>
<p>We’re left with a dataframe of 19 rows and 4 columns. It now contains everything we need.</p>
<p>Next, we’ll construct a “for loop” to extract the info we need from each page. We’re going to build it up step-by-step, beginning with the the basic elements of our “for loop.”</p>
<p>The codeblock below says: “Make a list with the row numbers from 1 to the number of rows in our naics_industry dataframe (which is 19). Then, for each element of that list (1, 2, 3, 4, 5 and so on up to 19), use slice() to keep only the one row that matches that number and save this newly created dataframe as each_row_df. Print out the dataframe. Then go to the next element on the list and do the same thing. Keep doing that until we hit number 19, then stop.”</p>
<p>We get 19 dataframes, each with one row, one for each sector.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="advanced-rvest.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop, iterating over each row in our naics industry dataframe</span></span>
<span id="cb283-2"><a href="advanced-rvest.html#cb283-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-3"><a href="advanced-rvest.html#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb283-4"><a href="advanced-rvest.html#cb283-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb283-5"><a href="advanced-rvest.html#cb283-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the row for a given row number, get rid of every other row</span></span>
<span id="cb283-6"><a href="advanced-rvest.html#cb283-6" aria-hidden="true" tabindex="-1"></a>    each_row_df <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb283-7"><a href="advanced-rvest.html#cb283-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(row_number) </span>
<span id="cb283-8"><a href="advanced-rvest.html#cb283-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb283-9"><a href="advanced-rvest.html#cb283-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To help us see what&#39;s happening as we build this, we&#39;re going to print the thing we&#39;re creating.  </span></span>
<span id="cb283-10"><a href="advanced-rvest.html#cb283-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(each_row_df)</span>
<span id="cb283-11"><a href="advanced-rvest.html#cb283-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb283-12"><a href="advanced-rvest.html#cb283-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   sector description                   sector_url                sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                         &lt;chr&gt;                     &lt;chr&gt;          
## 1 11     Agriculture, Forestry, Fishi… https://www.bls.gov/iag/… iag11emp1      
## # A tibble: 1 x 4
##   sector description                    sector_url               sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                          &lt;chr&gt;                    &lt;chr&gt;          
## 1 21     Mining, Quarrying, and Oil an… https://www.bls.gov/iag… iag21emp1      
## # A tibble: 1 x 4
##   sector description sector_url                            sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;                                 &lt;chr&gt;          
## 1 22     Utilities   https://www.bls.gov/iag/tgs/iag22.htm iag22emp1      
## # A tibble: 1 x 4
##   sector description  sector_url                            sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;                                 &lt;chr&gt;          
## 1 23     Construction https://www.bls.gov/iag/tgs/iag23.htm iag23emp1      
## # A tibble: 1 x 4
##   sector description   sector_url                               sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt;                                    &lt;chr&gt;          
## 1 31-33  Manufacturing https://www.bls.gov/iag/tgs/iag31-33.htm iag31-33emp1   
## # A tibble: 1 x 4
##   sector description     sector_url                            sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;                                 &lt;chr&gt;          
## 1 42     Wholesale Trade https://www.bls.gov/iag/tgs/iag42.htm iag42emp1      
## # A tibble: 1 x 4
##   sector description  sector_url                               sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;                                    &lt;chr&gt;          
## 1 44-45  Retail Trade https://www.bls.gov/iag/tgs/iag44-45.htm iag44-45emp1   
## # A tibble: 1 x 4
##   sector description              sector_url                     sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                    &lt;chr&gt;                          &lt;chr&gt;          
## 1 48-49  Transportation and Ware… https://www.bls.gov/iag/tgs/i… iag48-49emp1   
## # A tibble: 1 x 4
##   sector description sector_url                            sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;                                 &lt;chr&gt;          
## 1 51     Information https://www.bls.gov/iag/tgs/iag51.htm iag51emp1      
## # A tibble: 1 x 4
##   sector description          sector_url                         sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                &lt;chr&gt;                              &lt;chr&gt;          
## 1 52     Finance and Insuran… https://www.bls.gov/iag/tgs/iag52… iag52emp1      
## # A tibble: 1 x 4
##   sector description                 sector_url                  sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;                       &lt;chr&gt;          
## 1 53     Real Estate and Rental and… https://www.bls.gov/iag/tg… iag53emp1      
## # A tibble: 1 x 4
##   sector description                     sector_url              sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                           &lt;chr&gt;                   &lt;chr&gt;          
## 1 54     Professional, Scientific, and … https://www.bls.gov/ia… iag54emp1      
## # A tibble: 1 x 4
##   sector description                  sector_url                 sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                        &lt;chr&gt;                      &lt;chr&gt;          
## 1 55     Management of Companies and… https://www.bls.gov/iag/t… iag55emp1      
## # A tibble: 1 x 4
##   sector description                        sector_url           sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                              &lt;chr&gt;                &lt;chr&gt;          
## 1 56     Administrative and Support and Wa… https://www.bls.gov… iag56emp1      
## # A tibble: 1 x 4
##   sector description          sector_url                         sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                &lt;chr&gt;                              &lt;chr&gt;          
## 1 61     Educational Services https://www.bls.gov/iag/tgs/iag61… iag61emp1      
## # A tibble: 1 x 4
##   sector description                sector_url                   sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                      &lt;chr&gt;                        &lt;chr&gt;          
## 1 62     Health Care and Social As… https://www.bls.gov/iag/tgs… iag62emp1      
## # A tibble: 1 x 4
##   sector description                 sector_url                  sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;                       &lt;chr&gt;          
## 1 71     Arts, Entertainment, and R… https://www.bls.gov/iag/tg… iag71emp1      
## # A tibble: 1 x 4
##   sector description                sector_url                   sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                      &lt;chr&gt;                        &lt;chr&gt;          
## 1 72     Accommodation and Food Se… https://www.bls.gov/iag/tgs… iag72emp1      
## # A tibble: 1 x 4
##   sector description                    sector_url               sector_xpath_id
##   &lt;chr&gt;  &lt;chr&gt;                          &lt;chr&gt;                    &lt;chr&gt;          
## 1 81     Other Services (except Public… https://www.bls.gov/iag… iag81emp1</code></pre>
<p>We’re almost to the part where we can go out and fetch the html we need. Before we do that, let’s store as part of our loop an object called “url,” which contains the URL of the page for each sector.</p>
<p>The syntax with the dollar sign is a little funky, but “each_row_df$sector_url” says “from the each_row_df dataframe, grab the information in the sector_url column.” Because the column has only one row, there’s one value.</p>
<p>We’re going to do something simliar with the xpath for our employment table by using the information in the sector_xpath_id column.</p>
<p>That code also looks a little unwieldly. Recall that the xpath for the mining industry was <code>'//*[@id="iag22emp1"]'</code>.</p>
<p>In the code below, we’re building the xpath dynamically by pasting together the parts that stay the same for each xpath – <code>'//*[@id="'</code> and <code>'"]'</code> – and the parts that change for each sector, pulled from the xpath_sector_id column.</p>
<p>To see how this is working, we’re going to edit our print statement at the end a bit, printing the row_number and the dynamically created url and xpath.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="advanced-rvest.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop, iterating over each row in our naics industry dataframe</span></span>
<span id="cb285-2"><a href="advanced-rvest.html#cb285-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-3"><a href="advanced-rvest.html#cb285-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb285-4"><a href="advanced-rvest.html#cb285-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb285-5"><a href="advanced-rvest.html#cb285-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the row for a given row number, get rid of every other row</span></span>
<span id="cb285-6"><a href="advanced-rvest.html#cb285-6" aria-hidden="true" tabindex="-1"></a>    each_row_df <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb285-7"><a href="advanced-rvest.html#cb285-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(row_number) </span>
<span id="cb285-8"><a href="advanced-rvest.html#cb285-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb285-9"><a href="advanced-rvest.html#cb285-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define url of page to get</span></span>
<span id="cb285-10"><a href="advanced-rvest.html#cb285-10" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> each_row_df<span class="sc">$</span>sector_url</span>
<span id="cb285-11"><a href="advanced-rvest.html#cb285-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb285-12"><a href="advanced-rvest.html#cb285-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define id of table to ingest</span></span>
<span id="cb285-13"><a href="advanced-rvest.html#cb285-13" aria-hidden="true" tabindex="-1"></a>    xpath_employment_table <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;//*[@id=&quot;&#39;</span>,each_row_df<span class="sc">$</span>sector_xpath_id,<span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb285-14"><a href="advanced-rvest.html#cb285-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb285-15"><a href="advanced-rvest.html#cb285-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To help us see what&#39;s happening as we build this, we&#39;re going to print the thing we&#39;re creating.  </span></span>
<span id="cb285-16"><a href="advanced-rvest.html#cb285-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;ROW NUMBER:&quot;</span>, row_number,<span class="st">&quot; URL: &quot;</span>,url,<span class="st">&quot; XPATH:&quot;</span>,xpath_employment_table))</span>
<span id="cb285-17"><a href="advanced-rvest.html#cb285-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb285-18"><a href="advanced-rvest.html#cb285-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;ROW NUMBER:1 URL: https://www.bls.gov/iag/tgs/iag11.htm XPATH://*[@id=\&quot;iag11emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:2 URL: https://www.bls.gov/iag/tgs/iag21.htm XPATH://*[@id=\&quot;iag21emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:3 URL: https://www.bls.gov/iag/tgs/iag22.htm XPATH://*[@id=\&quot;iag22emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:4 URL: https://www.bls.gov/iag/tgs/iag23.htm XPATH://*[@id=\&quot;iag23emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:5 URL: https://www.bls.gov/iag/tgs/iag31-33.htm XPATH://*[@id=\&quot;iag31-33emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:6 URL: https://www.bls.gov/iag/tgs/iag42.htm XPATH://*[@id=\&quot;iag42emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:7 URL: https://www.bls.gov/iag/tgs/iag44-45.htm XPATH://*[@id=\&quot;iag44-45emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:8 URL: https://www.bls.gov/iag/tgs/iag48-49.htm XPATH://*[@id=\&quot;iag48-49emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:9 URL: https://www.bls.gov/iag/tgs/iag51.htm XPATH://*[@id=\&quot;iag51emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:10 URL: https://www.bls.gov/iag/tgs/iag52.htm XPATH://*[@id=\&quot;iag52emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:11 URL: https://www.bls.gov/iag/tgs/iag53.htm XPATH://*[@id=\&quot;iag53emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:12 URL: https://www.bls.gov/iag/tgs/iag54.htm XPATH://*[@id=\&quot;iag54emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:13 URL: https://www.bls.gov/iag/tgs/iag55.htm XPATH://*[@id=\&quot;iag55emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:14 URL: https://www.bls.gov/iag/tgs/iag56.htm XPATH://*[@id=\&quot;iag56emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:15 URL: https://www.bls.gov/iag/tgs/iag61.htm XPATH://*[@id=\&quot;iag61emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:16 URL: https://www.bls.gov/iag/tgs/iag62.htm XPATH://*[@id=\&quot;iag62emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:17 URL: https://www.bls.gov/iag/tgs/iag71.htm XPATH://*[@id=\&quot;iag71emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:18 URL: https://www.bls.gov/iag/tgs/iag72.htm XPATH://*[@id=\&quot;iag72emp1\&quot;]&quot;
## [1] &quot;ROW NUMBER:19 URL: https://www.bls.gov/iag/tgs/iag81.htm XPATH://*[@id=\&quot;iag81emp1\&quot;]&quot;</code></pre>
<p>Armed with the URL and xpath for each sector web page, we can now go out and get the employment table for each sector.</p>
<p>We’ll read in the html from the url we just stored; extract the table that has the xpath ID we just created; and then transform the html table code into a proper dataframe.</p>
<p>The dataframe is hidden inside a nested list, which we’ll have to extract in the next step.</p>
<p>So, when you run this code, it will print out 19 dataframes inside of nested lists, each containing one dataframe.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="advanced-rvest.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop, iterating over each row in our naics industry dataframe</span></span>
<span id="cb287-2"><a href="advanced-rvest.html#cb287-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-3"><a href="advanced-rvest.html#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb287-4"><a href="advanced-rvest.html#cb287-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb287-5"><a href="advanced-rvest.html#cb287-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the row for a given row number, get rid of every other row</span></span>
<span id="cb287-6"><a href="advanced-rvest.html#cb287-6" aria-hidden="true" tabindex="-1"></a>    each_row_df <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb287-7"><a href="advanced-rvest.html#cb287-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(row_number) </span>
<span id="cb287-8"><a href="advanced-rvest.html#cb287-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb287-9"><a href="advanced-rvest.html#cb287-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define url of page to get</span></span>
<span id="cb287-10"><a href="advanced-rvest.html#cb287-10" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> each_row_df<span class="sc">$</span>sector_url</span>
<span id="cb287-11"><a href="advanced-rvest.html#cb287-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb287-12"><a href="advanced-rvest.html#cb287-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define id of table to ingest</span></span>
<span id="cb287-13"><a href="advanced-rvest.html#cb287-13" aria-hidden="true" tabindex="-1"></a>    xpath_employment_table <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;//*[@id=&quot;&#39;</span>,each_row_df<span class="sc">$</span>sector_xpath_id,<span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb287-14"><a href="advanced-rvest.html#cb287-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb287-15"><a href="advanced-rvest.html#cb287-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get employment table from each page by going to each url defined above, reading in the html with read_html(), extracting the table with the id generated by the xpath code using html_elements), and then turning the html into a proper dataframe using html_table(). The dataframe is in a nested list, which we&#39;ll have to extract in the next step.</span></span>
<span id="cb287-16"><a href="advanced-rvest.html#cb287-16" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb287-17"><a href="advanced-rvest.html#cb287-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb287-18"><a href="advanced-rvest.html#cb287-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_elements</span>(<span class="at">xpath =</span> xpath_employment_table) <span class="sc">%&gt;%</span></span>
<span id="cb287-19"><a href="advanced-rvest.html#cb287-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() </span>
<span id="cb287-20"><a href="advanced-rvest.html#cb287-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb287-21"><a href="advanced-rvest.html#cb287-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To help us see what&#39;s happening as we build this, we&#39;re going to print the thing we&#39;re creating.  </span></span>
<span id="cb287-22"><a href="advanced-rvest.html#cb287-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(employment_info)</span>
<span id="cb287-23"><a href="advanced-rvest.html#cb287-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb287-24"><a href="advanced-rvest.html#cb287-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb287-25"><a href="advanced-rvest.html#cb287-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 2 x 6
##   `Data series`     Backdata Jul.2021 Aug.2021 Sep.2021 Oct.2021
##   &lt;chr&gt;             &lt;lgl&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Unemployment      NA       &quot;&quot;       &quot;&quot;       &quot;&quot;       &quot;&quot;      
## 2 Unemployment rate NA       &quot;7.6%&quot;   &quot;5.7%&quot;   &quot;5.0%&quot;   &quot;5.1%&quot;  
## 
## [[1]]
## # A tibble: 6 x 6
##   `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021    Oct.2021  
##   &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     
## 1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 2 Employment, all em… &quot;&quot;          &quot;592.5&quot;     &quot;598.8&quot;     &quot;(p)603.7&quot;  &quot;(p)608.6&quot;
## 3 Employment, produc… &quot;&quot;          &quot;433.6&quot;     &quot;439.3&quot;     &quot;(p)444.6&quot;  &quot;&quot;        
## 4 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 5 Unemployment rate   &quot;&quot;          &quot;8.9%&quot;      &quot;10.2%&quot;     &quot;7.3%&quot;      &quot;10.0%&quot;   
## 6 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote…
## 
## [[1]]
## # A tibble: 6 x 6
##   `Data series`          Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##   &lt;chr&gt;                  &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
## 1 Employment (in thousa… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
## 2 Employment, all emplo… &quot;&quot;          &quot;538.9&quot;    &quot;536.7&quot;    &quot;(p)536.5&quot; &quot;(p)536.7&quot;
## 3 Employment, productio… &quot;&quot;          &quot;429.1&quot;    &quot;426.9&quot;    &quot;(p)426.8&quot; &quot;(p)427.4&quot;
## 4 Unemployment           &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
## 5 Unemployment rate      &quot;&quot;          &quot;3.4%&quot;     &quot;2.7%&quot;     &quot;3.1%&quot;     &quot;1.8%&quot;    
## 6 Footnotes(p) Prelimin… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`         Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##    &lt;chr&gt;                 &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in thous… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  2 Employment, all empl… &quot;&quot;          &quot;7,425&quot;    &quot;7,424&quot;    &quot;(p)7,454&quot; &quot;(p)7,498&quot;
##  3 Employment, producti… &quot;&quot;          &quot;5,517&quot;    &quot;5,504&quot;    &quot;(p)5,522&quot; &quot;(p)5,522&quot;
##  4 Unemployment          &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate     &quot;&quot;          &quot;6.1%&quot;     &quot;4.6%&quot;     &quot;4.5%&quot;     &quot;4.0%&quot;    
##  6 Job openings, hires,… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  7 Job openings          &quot;&quot;          &quot;377&quot;      &quot;384&quot;      &quot;(p)316&quot;   &quot;&quot;        
##  8 Hires                 &quot;&quot;          &quot;430&quot;      &quot;395&quot;      &quot;(p)341&quot;   &quot;&quot;        
##  9 Separations           &quot;&quot;          &quot;402&quot;      &quot;439&quot;      &quot;(p)336&quot;   &quot;&quot;        
## 10 Footnotes(p) Prelimi… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`         Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##    &lt;chr&gt;                 &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in thous… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  2 Employment, all empl… &quot;&quot;          &quot;12,389&quot;   &quot;12,438&quot;   &quot;(p)12,46… &quot;(p)12,52…
##  3 Employment, producti… &quot;&quot;          &quot;8,617&quot;    &quot;8,649&quot;    &quot;(p)8,660&quot; &quot;(p)8,716&quot;
##  4 Unemployment          &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate     &quot;&quot;          &quot;4.2%&quot;     &quot;3.6%&quot;     &quot;3.9%&quot;     &quot;3.3%&quot;    
##  6 Job openings, hires,… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  7 Job openings          &quot;&quot;          &quot;974&quot;      &quot;889&quot;      &quot;(p)899&quot;   &quot;&quot;        
##  8 Hires                 &quot;&quot;          &quot;526&quot;      &quot;518&quot;      &quot;(p)504&quot;   &quot;&quot;        
##  9 Separations           &quot;&quot;          &quot;452&quot;      &quot;527&quot;      &quot;(p)479&quot;   &quot;&quot;        
## 10 Footnotes(p) Prelimi… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`         Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##    &lt;chr&gt;                 &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in thous… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  2 Employment, all empl… &quot;&quot;          &quot;5,722.1&quot;  &quot;5,716.9&quot;  &quot;(p)5,724… &quot;(p)5,737…
##  3 Employment, producti… &quot;&quot;          &quot;4,547.8&quot;  &quot;4,549.2&quot;  &quot;(p)4,558… &quot;(p)4,569…
##  4 Unemployment          &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate     &quot;&quot;          &quot;4.6%&quot;     &quot;4.3%&quot;     &quot;3.7%&quot;     &quot;4.2%&quot;    
##  6 Job openings, hires,… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  7 Job openings          &quot;&quot;          &quot;291&quot;      &quot;261&quot;      &quot;(p)320&quot;   &quot;&quot;        
##  8 Hires                 &quot;&quot;          &quot;199&quot;      &quot;203&quot;      &quot;(p)197&quot;   &quot;&quot;        
##  9 Separations           &quot;&quot;          &quot;177&quot;      &quot;220&quot;      &quot;(p)175&quot;   &quot;&quot;        
## 10 Footnotes(p) Prelimi… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`         Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##    &lt;chr&gt;                 &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in thous… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  2 Employment, all empl… &quot;&quot;          &quot;15,355.3&quot; &quot;15,377.5&quot; &quot;(p)15,43… &quot;(p)15,47…
##  3 Employment, producti… &quot;&quot;          &quot;13,068.6&quot; &quot;13,089.0&quot; &quot;(p)13,14… &quot;(p)13,18…
##  4 Unemployment          &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate     &quot;&quot;          &quot;6.4%&quot;     &quot;6.5%&quot;     &quot;6.1%&quot;     &quot;5.4%&quot;    
##  6 Job openings, hires,… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  7 Job openings          &quot;&quot;          &quot;1,245&quot;    &quot;1,346&quot;    &quot;(p)1,231&quot; &quot;&quot;        
##  8 Hires                 &quot;&quot;          &quot;905&quot;      &quot;1,010&quot;    &quot;(p)892&quot;   &quot;&quot;        
##  9 Separations           &quot;&quot;          &quot;913&quot;      &quot;1,100&quot;    &quot;(p)843&quot;   &quot;&quot;        
## 10 Footnotes(p) Prelimi… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 6 x 6
##   `Data series`          Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##   &lt;chr&gt;                  &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
## 1 Employment (in thousa… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
## 2 Employment, all emplo… &quot;&quot;          &quot;5,792.9&quot;  &quot;5,860.2&quot;  &quot;(p)5,917… &quot;(p)5,972…
## 3 Employment, productio… &quot;&quot;          &quot;5,052.6&quot;  &quot;5,089.7&quot;  &quot;(p)5,119… &quot;(p)5,152…
## 4 Unemployment           &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
## 5 Unemployment rate      &quot;&quot;          &quot;7.3%&quot;     &quot;6.4%&quot;     &quot;5.7%&quot;     &quot;5.1%&quot;    
## 6 Footnotes(p) Prelimin… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`         Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##    &lt;chr&gt;                 &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in thous… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  2 Employment, all empl… &quot;&quot;          &quot;2,745&quot;    &quot;2,778&quot;    &quot;(p)2,782&quot; &quot;(p)2,792&quot;
##  3 Employment, producti… &quot;&quot;          &quot;2,183&quot;    &quot;2,207&quot;    &quot;(p)2,216&quot; &quot;(p)2,219&quot;
##  4 Unemployment          &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate     &quot;&quot;          &quot;5.6%&quot;     &quot;4.4%&quot;     &quot;4.0%&quot;     &quot;3.5%&quot;    
##  6 Job openings, hires,… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  7 Job openings          &quot;&quot;          &quot;181&quot;      &quot;193&quot;      &quot;(p)243&quot;   &quot;&quot;        
##  8 Hires                 &quot;&quot;          &quot;106&quot;      &quot;112&quot;      &quot;(p)113&quot;   &quot;&quot;        
##  9 Separations           &quot;&quot;          &quot;85&quot;       &quot;91&quot;       &quot;(p)72&quot;    &quot;&quot;        
## 10 Footnotes(p) Prelimi… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 9 x 6
##   `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021    Oct.2021  
##   &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     
## 1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 2 Employment, all em… &quot;&quot;          &quot;6,545.1&quot;   &quot;6,550.3&quot;   &quot;(p)6,544.… &quot;(p)6,553…
## 3 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 4 Unemployment rate   &quot;&quot;          &quot;3.1%&quot;      &quot;3.5%&quot;      &quot;2.0%&quot;      &quot;1.8%&quot;    
## 5 Job openings, hire… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 6 Job openings        &quot;&quot;          &quot;354&quot;       &quot;285&quot;       &quot;(p)298&quot;    &quot;&quot;        
## 7 Hires               &quot;&quot;          &quot;164&quot;       &quot;134&quot;       &quot;(p)193&quot;    &quot;&quot;        
## 8 Separations         &quot;&quot;          &quot;140&quot;       &quot;173&quot;       &quot;(p)191&quot;    &quot;&quot;        
## 9 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote…
## 
## [[1]]
## # A tibble: 9 x 6
##   `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021    Oct.2021  
##   &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     
## 1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 2 Employment, all em… &quot;&quot;          &quot;2,291.9&quot;   &quot;2,303.7&quot;   &quot;(p)2,316.… &quot;(p)2,328…
## 3 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 4 Unemployment rate   &quot;&quot;          &quot;2.8%&quot;      &quot;2.6%&quot;      &quot;3.8%&quot;      &quot;2.2%&quot;    
## 5 Job openings, hire… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 6 Job openings        &quot;&quot;          &quot;199&quot;       &quot;183&quot;       &quot;(p)112&quot;    &quot;&quot;        
## 7 Hires               &quot;&quot;          &quot;89&quot;        &quot;79&quot;        &quot;(p)68&quot;     &quot;&quot;        
## 8 Separations         &quot;&quot;          &quot;82&quot;        &quot;81&quot;        &quot;(p)57&quot;     &quot;&quot;        
## 9 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote…
## 
## [[1]]
## # A tibble: 6 x 6
##   `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021    Oct.2021  
##   &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     
## 1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 2 Employment, all em… &quot;&quot;          &quot;9,839.0&quot;   &quot;9,906.3&quot;   &quot;(p)9,961.… &quot;(p)10,00…
## 3 Employment, produc… &quot;&quot;          &quot;7,593.2&quot;   &quot;7,612.3&quot;   &quot;(p)7,580.… &quot;&quot;        
## 4 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 5 Unemployment rate   &quot;&quot;          &quot;3.2%&quot;      &quot;2.7%&quot;      &quot;2.5%&quot;      &quot;2.6%&quot;    
## 6 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote…
## 
## [[1]]
## # A tibble: 4 x 6
##   `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021    Oct.2021  
##   &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     
## 1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 2 Employment, all em… &quot;&quot;          &quot;2,329.8&quot;   &quot;2,336.9&quot;   &quot;(p)2,339.… &quot;(p)2,345…
## 3 Employment, produc… &quot;&quot;          &quot;1,526.8&quot;   &quot;1,522.9&quot;   &quot;(p)1,522.… &quot;&quot;        
## 4 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote…
## 
## [[1]]
## # A tibble: 4 x 6
##   `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021    Oct.2021  
##   &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     
## 1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 2 Employment, all em… &quot;&quot;          &quot;8,770.3&quot;   &quot;8,835.1&quot;   &quot;(p)8,852.… &quot;(p)8,901…
## 3 Employment, produc… &quot;&quot;          &quot;7,755.2&quot;   &quot;7,839.8&quot;   &quot;(p)7,894.… &quot;&quot;        
## 4 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote…
## 
## [[1]]
## # A tibble: 9 x 6
##   `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021    Oct.2021  
##   &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     
## 1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 2 Employment, all em… &quot;&quot;          &quot;3,576.1&quot;   &quot;3,634.2&quot;   &quot;(p)3,613.… &quot;(p)3,630…
## 3 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 4 Unemployment rate   &quot;&quot;          &quot;6.7%&quot;      &quot;6.1%&quot;      &quot;3.9%&quot;      &quot;3.0%&quot;    
## 5 Job openings, hire… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;        
## 6 Job openings        &quot;&quot;          &quot;221&quot;       &quot;188&quot;       &quot;(p)129&quot;    &quot;&quot;        
## 7 Hires               &quot;&quot;          &quot;143&quot;       &quot;213&quot;       &quot;(p)109&quot;    &quot;&quot;        
## 8 Separations         &quot;&quot;          &quot;88&quot;        &quot;116&quot;       &quot;(p)89&quot;     &quot;&quot;        
## 9 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021   Oct.2021  
##    &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  2 Employment, all em… &quot;&quot;          &quot;20,044.8&quot;  &quot;20,058.5&quot;  &quot;(p)20,09… &quot;(p)20,13…
##  3 Employment, produc… &quot;&quot;          &quot;17,594.0&quot;  &quot;17,603.8&quot;  &quot;(p)17,55… &quot;&quot;        
##  4 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate   &quot;&quot;          &quot;3.8%&quot;      &quot;3.9%&quot;      &quot;3.1%&quot;     &quot;2.7%&quot;    
##  6 Job openings, hire… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  7 Job openings        &quot;&quot;          &quot;1,813&quot;     &quot;1,565&quot;     &quot;(p)1,702&quot; &quot;&quot;        
##  8 Hires               &quot;&quot;          &quot;763&quot;       &quot;764&quot;       &quot;(p)800&quot;   &quot;&quot;        
##  9 Separations         &quot;&quot;          &quot;728&quot;       &quot;722&quot;       &quot;(p)768&quot;   &quot;&quot;        
## 10 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021   Oct.2021  
##    &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  2 Employment, all em… &quot;&quot;          &quot;2,093.4&quot;   &quot;2,156.8&quot;   &quot;(p)2,196… &quot;(p)2,217…
##  3 Employment, produc… &quot;&quot;          &quot;2,031.8&quot;   &quot;2,017.6&quot;   &quot;(p)1,855… &quot;&quot;        
##  4 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate   &quot;&quot;          &quot;8.3%&quot;      &quot;7.7%&quot;      &quot;7.2%&quot;     &quot;6.5%&quot;    
##  6 Job openings, hire… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  7 Job openings        &quot;&quot;          &quot;234&quot;       &quot;218&quot;       &quot;(p)184&quot;   &quot;&quot;        
##  8 Hires               &quot;&quot;          &quot;199&quot;       &quot;151&quot;       &quot;(p)159&quot;   &quot;&quot;        
##  9 Separations         &quot;&quot;          &quot;119&quot;       &quot;212&quot;       &quot;(p)249&quot;   &quot;&quot;        
## 10 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`       Backdata    Jul.2021    Aug.2021    Sep.2021   Oct.2021  
##    &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in tho… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  2 Employment, all em… &quot;&quot;          &quot;13,115.3&quot;  &quot;13,122.8&quot;  &quot;(p)13,17… &quot;(p)13,31…
##  3 Employment, produc… &quot;&quot;          &quot;11,759.2&quot;  &quot;11,724.5&quot;  &quot;(p)11,49… &quot;&quot;        
##  4 Unemployment        &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate   &quot;&quot;          &quot;9.2%&quot;      &quot;9.4%&quot;      &quot;7.8%&quot;     &quot;7.7%&quot;    
##  6 Job openings, hire… &quot;&quot;          &quot;&quot;          &quot;&quot;          &quot;&quot;         &quot;&quot;        
##  7 Job openings        &quot;&quot;          &quot;1,793&quot;     &quot;1,518&quot;     &quot;(p)1,394&quot; &quot;&quot;        
##  8 Hires               &quot;&quot;          &quot;1,443&quot;     &quot;1,135&quot;     &quot;(p)1,002&quot; &quot;&quot;        
##  9 Separations         &quot;&quot;          &quot;1,005&quot;     &quot;1,278&quot;     &quot;(p)1,169&quot; &quot;&quot;        
## 10 Footnotes(p) Preli… &quot;Footnotes… &quot;Footnotes… &quot;Footnotes… &quot;Footnote… &quot;Footnote…
## 
## [[1]]
## # A tibble: 10 x 6
##    `Data series`         Backdata    Jul.2021   Aug.2021   Sep.2021   Oct.2021  
##    &lt;chr&gt;                 &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1 Employment (in thous… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  2 Employment, all empl… &quot;&quot;          &quot;5,709&quot;    &quot;5,745&quot;    &quot;(p)5,735&quot; &quot;(p)5,768&quot;
##  3 Employment, producti… &quot;&quot;          &quot;4,642&quot;    &quot;4,676&quot;    &quot;(p)4,672&quot; &quot;(p)4,700&quot;
##  4 Unemployment          &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  5 Unemployment rate     &quot;&quot;          &quot;4.9%&quot;     &quot;5.0%&quot;     &quot;4.2%&quot;     &quot;3.5%&quot;    
##  6 Job openings, hires,… &quot;&quot;          &quot;&quot;         &quot;&quot;         &quot;&quot;         &quot;&quot;        
##  7 Job openings          &quot;&quot;          &quot;501&quot;      &quot;500&quot;      &quot;(p)382&quot;   &quot;&quot;        
##  8 Hires                 &quot;&quot;          &quot;327&quot;      &quot;243&quot;      &quot;(p)239&quot;   &quot;&quot;        
##  9 Separations           &quot;&quot;          &quot;275&quot;      &quot;239&quot;      &quot;(p)304&quot;   &quot;&quot;        
## 10 Footnotes(p) Prelimi… &quot;Footnotes… &quot;Footnote… &quot;Footnote… &quot;Footnote… &quot;Footnote…</code></pre>
<p>In this next step, we use employment_info &lt;- employment_info[[1]] to extract each dataframe from the nested list. Then we’ll tidy up the dataframe a bit. We’ll use the get rid of all the information we don’t need in the table, by using slice() to keep only the second row. We’ll also standardize the column names with clean_names().</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="advanced-rvest.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop, iterating over each row in our naics industry dataframe</span></span>
<span id="cb289-2"><a href="advanced-rvest.html#cb289-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-3"><a href="advanced-rvest.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb289-4"><a href="advanced-rvest.html#cb289-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb289-5"><a href="advanced-rvest.html#cb289-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the row for a given row number, get rid of every other row</span></span>
<span id="cb289-6"><a href="advanced-rvest.html#cb289-6" aria-hidden="true" tabindex="-1"></a>    each_row_df <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb289-7"><a href="advanced-rvest.html#cb289-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(row_number) </span>
<span id="cb289-8"><a href="advanced-rvest.html#cb289-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb289-9"><a href="advanced-rvest.html#cb289-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define url of page to get</span></span>
<span id="cb289-10"><a href="advanced-rvest.html#cb289-10" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> each_row_df<span class="sc">$</span>sector_url</span>
<span id="cb289-11"><a href="advanced-rvest.html#cb289-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb289-12"><a href="advanced-rvest.html#cb289-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define id of table to ingest</span></span>
<span id="cb289-13"><a href="advanced-rvest.html#cb289-13" aria-hidden="true" tabindex="-1"></a>    xpath_employment_table <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;//*[@id=&quot;&#39;</span>,each_row_df<span class="sc">$</span>sector_xpath_id,<span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb289-14"><a href="advanced-rvest.html#cb289-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb289-15"><a href="advanced-rvest.html#cb289-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get employment table from each page by going to each url defined above, reading in the html with read_html(), extracting the table with the id generated by the xpath code using html_elements), and then turning the html into a proper dataframe using html_table().  The dataframe is in a nested list, which we&#39;ll have to extract in the next step.</span></span>
<span id="cb289-16"><a href="advanced-rvest.html#cb289-16" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb289-17"><a href="advanced-rvest.html#cb289-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb289-18"><a href="advanced-rvest.html#cb289-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_elements</span>(<span class="at">xpath =</span> xpath_employment_table) <span class="sc">%&gt;%</span></span>
<span id="cb289-19"><a href="advanced-rvest.html#cb289-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() </span>
<span id="cb289-20"><a href="advanced-rvest.html#cb289-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb289-21"><a href="advanced-rvest.html#cb289-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grab the dataframe out of the list (it&#39;s the first and only element inside the list); clean up the field names with clean_names(); use slice(2) to keep only the second row; </span></span>
<span id="cb289-22"><a href="advanced-rvest.html#cb289-22" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> employment_info[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb289-23"><a href="advanced-rvest.html#cb289-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb289-24"><a href="advanced-rvest.html#cb289-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">2</span>) </span>
<span id="cb289-25"><a href="advanced-rvest.html#cb289-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb289-26"><a href="advanced-rvest.html#cb289-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To help us see what&#39;s happening as we build this, we&#39;re going to print the thing we&#39;re creating.  </span></span>
<span id="cb289-27"><a href="advanced-rvest.html#cb289-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(employment_info)</span>
<span id="cb289-28"><a href="advanced-rvest.html#cb289-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb289-29"><a href="advanced-rvest.html#cb289-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb289-30"><a href="advanced-rvest.html#cb289-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   data_series       backdata jul_2021 aug_2021 sep_2021 oct_2021
##   &lt;chr&gt;             &lt;lgl&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Unemployment rate NA       7.6%     5.7%     5.0%     5.1%    
## # A tibble: 1 x 6
##   data_series                       backdata jul_2021 aug_2021 sep_2021 oct_2021
##   &lt;chr&gt;                             &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Employment, all employees  (seas… &quot;&quot;       592.5    598.8    (p)603.7 (p)608.6
## # A tibble: 1 x 6
##   data_series                       backdata jul_2021 aug_2021 sep_2021 oct_2021
##   &lt;chr&gt;                             &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Employment, all employees  (seas… &quot;&quot;       538.9    536.7    (p)536.5 (p)536.7
## # A tibble: 1 x 6
##   data_series                       backdata jul_2021 aug_2021 sep_2021 oct_2021
##   &lt;chr&gt;                             &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Employment, all employees  (seas… &quot;&quot;       7,425    7,424    (p)7,454 (p)7,498
## # A tibble: 1 x 6
##   data_series                      backdata jul_2021 aug_2021 sep_2021  oct_2021
##   &lt;chr&gt;                            &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   
## 1 Employment, all employees  (sea… &quot;&quot;       12,389   12,438   (p)12,469 (p)12,5…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       5,722.1  5,716.9  (p)5,724… (p)5,737…
## # A tibble: 1 x 6
##   data_series                    backdata jul_2021 aug_2021 sep_2021   oct_2021 
##   &lt;chr&gt;                          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    
## 1 Employment, all employees  (s… &quot;&quot;       15,355.3 15,377.5 (p)15,434… (p)15,47…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       5,792.9  5,860.2  (p)5,917… (p)5,972…
## # A tibble: 1 x 6
##   data_series                       backdata jul_2021 aug_2021 sep_2021 oct_2021
##   &lt;chr&gt;                             &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Employment, all employees  (seas… &quot;&quot;       2,745    2,778    (p)2,782 (p)2,792
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       6,545.1  6,550.3  (p)6,544… (p)6,553…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       2,291.9  2,303.7  (p)2,316… (p)2,328…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       9,839.0  9,906.3  (p)9,961… (p)10,00…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       2,329.8  2,336.9  (p)2,339… (p)2,345…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       8,770.3  8,835.1  (p)8,852… (p)8,901…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       3,576.1  3,634.2  (p)3,613… (p)3,630…
## # A tibble: 1 x 6
##   data_series                    backdata jul_2021 aug_2021 sep_2021   oct_2021 
##   &lt;chr&gt;                          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    
## 1 Employment, all employees  (s… &quot;&quot;       20,044.8 20,058.5 (p)20,092… (p)20,13…
## # A tibble: 1 x 6
##   data_series                     backdata jul_2021 aug_2021 sep_2021  oct_2021 
##   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    
## 1 Employment, all employees  (se… &quot;&quot;       2,093.4  2,156.8  (p)2,196… (p)2,217…
## # A tibble: 1 x 6
##   data_series                    backdata jul_2021 aug_2021 sep_2021   oct_2021 
##   &lt;chr&gt;                          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    
## 1 Employment, all employees  (s… &quot;&quot;       13,115.3 13,122.8 (p)13,172… (p)13,31…
## # A tibble: 1 x 6
##   data_series                       backdata jul_2021 aug_2021 sep_2021 oct_2021
##   &lt;chr&gt;                             &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Employment, all employees  (seas… &quot;&quot;       5,709    5,745    (p)5,735 (p)5,768</code></pre>
<p>We now have 19 dataframes, each containing one row each and two columns, one of which is the employment number for a given sector for jul_2021. But we’re missing information about what industry sector these employment numbers represent.</p>
<p>We can add that back in by using bind_cols() to reconnect the each_row_df, which contains the sector code and the sector name.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="advanced-rvest.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop, iterating over each row in our naics industry dataframe</span></span>
<span id="cb291-2"><a href="advanced-rvest.html#cb291-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-3"><a href="advanced-rvest.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb291-4"><a href="advanced-rvest.html#cb291-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb291-5"><a href="advanced-rvest.html#cb291-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the row for a given row number, get rid of every other row</span></span>
<span id="cb291-6"><a href="advanced-rvest.html#cb291-6" aria-hidden="true" tabindex="-1"></a>    each_row_df <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb291-7"><a href="advanced-rvest.html#cb291-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(row_number) </span>
<span id="cb291-8"><a href="advanced-rvest.html#cb291-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb291-9"><a href="advanced-rvest.html#cb291-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define url of page to get</span></span>
<span id="cb291-10"><a href="advanced-rvest.html#cb291-10" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> each_row_df<span class="sc">$</span>sector_url</span>
<span id="cb291-11"><a href="advanced-rvest.html#cb291-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb291-12"><a href="advanced-rvest.html#cb291-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define id of table to ingest</span></span>
<span id="cb291-13"><a href="advanced-rvest.html#cb291-13" aria-hidden="true" tabindex="-1"></a>    xpath_employment_table <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;//*[@id=&quot;&#39;</span>,each_row_df<span class="sc">$</span>sector_xpath_id,<span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb291-14"><a href="advanced-rvest.html#cb291-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb291-15"><a href="advanced-rvest.html#cb291-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get employment table from each page by going to each url defined above, reading in the html with read_html(), extracting the table with the id generated by the xpath code using html_elements), and then turning the html into a proper dataframe using html_table().  The dataframe is in a nested list, which we&#39;ll have to extract in the next step.</span></span>
<span id="cb291-16"><a href="advanced-rvest.html#cb291-16" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb291-17"><a href="advanced-rvest.html#cb291-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb291-18"><a href="advanced-rvest.html#cb291-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_elements</span>(<span class="at">xpath =</span> xpath_employment_table) <span class="sc">%&gt;%</span></span>
<span id="cb291-19"><a href="advanced-rvest.html#cb291-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() </span>
<span id="cb291-20"><a href="advanced-rvest.html#cb291-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb291-21"><a href="advanced-rvest.html#cb291-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grab the dataframe out of the list (it&#39;s the first and only element inside the list); clean up the field names with clean_names(); use slice(2) to keep only the second row; use bind_cols() to append the sector code and name to this table.</span></span>
<span id="cb291-22"><a href="advanced-rvest.html#cb291-22" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> employment_info[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb291-23"><a href="advanced-rvest.html#cb291-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb291-24"><a href="advanced-rvest.html#cb291-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-25"><a href="advanced-rvest.html#cb291-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(each_row_df) </span>
<span id="cb291-26"><a href="advanced-rvest.html#cb291-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb291-27"><a href="advanced-rvest.html#cb291-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To help us see what&#39;s happening as we build this, we&#39;re going to print the thing we&#39;re creating.  </span></span>
<span id="cb291-28"><a href="advanced-rvest.html#cb291-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(employment_info)</span>
<span id="cb291-29"><a href="advanced-rvest.html#cb291-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb291-30"><a href="advanced-rvest.html#cb291-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb291-31"><a href="advanced-rvest.html#cb291-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## # A tibble: 1 x 10
##   data_series  backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description  
##   &lt;chr&gt;        &lt;lgl&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;        
## 1 Unemploymen… NA       7.6%     5.7%     5.0%     5.1%     11     Agriculture,…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       592.5    598.8    (p)603.7 (p)608.6 21     Mining, Qua…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       538.9    536.7    (p)536.5 (p)536.7 22     Utilities  
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       7,425    7,424    (p)7,454 (p)7,498 23     Constructi…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       12,389   12,438   (p)12,4… (p)12,5… 31-33  Manufactur…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       5,722.1  5,716.9  (p)5,72… (p)5,73… 42     Wholesale …
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       15,355.3 15,377.5 (p)15,4… (p)15,4… 44-45  Retail Tra…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021  oct_2021 sector description
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, … &quot;&quot;       5,792.9  5,860.2  (p)5,917… (p)5,97… 48-49  Transporta…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       2,745    2,778    (p)2,782 (p)2,792 51     Information
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       6,545.1  6,550.3  (p)6,54… (p)6,55… 52     Finance an…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       2,291.9  2,303.7  (p)2,31… (p)2,32… 53     Real Estate…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       9,839.0  9,906.3  (p)9,96… (p)10,0… 54     Professiona…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       2,329.8  2,336.9  (p)2,33… (p)2,34… 55     Management …
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       8,770.3  8,835.1  (p)8,85… (p)8,90… 56     Administrat…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series    backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description
##   &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, a… &quot;&quot;       3,576.1  3,634.2  (p)3,61… (p)3,63… 61     Educationa…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       20,044.8 20,058.5 (p)20,0… (p)20,1… 62     Health Care…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       2,093.4  2,156.8  (p)2,19… (p)2,21… 71     Arts, Enter…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021  oct_2021 sector description
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      
## 1 Employment, … &quot;&quot;       13,115.3 13,122.8 (p)13,17… (p)13,3… 72     Accommodat…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;
## # A tibble: 1 x 10
##   data_series   backdata jul_2021 aug_2021 sep_2021 oct_2021 sector description 
##   &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       
## 1 Employment, … &quot;&quot;       5,709    5,745    (p)5,735 (p)5,768 81     Other Servi…
## # … with 2 more variables: sector_url &lt;chr&gt;, sector_xpath_id &lt;chr&gt;</code></pre>
<p>Then we’ll do a little bit of cleaning.</p>
<p>Let’s use parse_number() to remove the comma from the jul_2021 number and convert it from a character to number. We’ll use rename() to make the jul_2021 column name a little more descriptive. And then we’ll use select() to keep only the columns we want to keep – the sector number, the sector name, and the jul_2021 employment number.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="advanced-rvest.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop, iterating over each row in our naics industry dataframe</span></span>
<span id="cb293-2"><a href="advanced-rvest.html#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb293-3"><a href="advanced-rvest.html#cb293-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-4"><a href="advanced-rvest.html#cb293-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the row for a given row number, get rid of every other row</span></span>
<span id="cb293-5"><a href="advanced-rvest.html#cb293-5" aria-hidden="true" tabindex="-1"></a>    each_row_df <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb293-6"><a href="advanced-rvest.html#cb293-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(row_number) </span>
<span id="cb293-7"><a href="advanced-rvest.html#cb293-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb293-8"><a href="advanced-rvest.html#cb293-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define url of page to get</span></span>
<span id="cb293-9"><a href="advanced-rvest.html#cb293-9" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> each_row_df<span class="sc">$</span>sector_url</span>
<span id="cb293-10"><a href="advanced-rvest.html#cb293-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-11"><a href="advanced-rvest.html#cb293-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define id of table to ingest</span></span>
<span id="cb293-12"><a href="advanced-rvest.html#cb293-12" aria-hidden="true" tabindex="-1"></a>    xpath_employment_table <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;//*[@id=&quot;&#39;</span>,each_row_df<span class="sc">$</span>sector_xpath_id,<span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb293-13"><a href="advanced-rvest.html#cb293-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-14"><a href="advanced-rvest.html#cb293-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get employment table from each page by going to each url defined above, reading in the html with read_html(), extracting the table with the id generated by the xpath code using html_elements), and then turning the html into a proper dataframe using html_table().  The dataframe is in a nested list, which we&#39;ll have to extract in the next step.</span></span>
<span id="cb293-15"><a href="advanced-rvest.html#cb293-15" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb293-16"><a href="advanced-rvest.html#cb293-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb293-17"><a href="advanced-rvest.html#cb293-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_elements</span>(<span class="at">xpath =</span> xpath_employment_table) <span class="sc">%&gt;%</span></span>
<span id="cb293-18"><a href="advanced-rvest.html#cb293-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() </span>
<span id="cb293-19"><a href="advanced-rvest.html#cb293-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-20"><a href="advanced-rvest.html#cb293-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grab the dataframe out of the list (it&#39;s the first and only element inside the list); clean up the field names with clean_names(); use slice(2) to keep only the second row; use bind_cols() to append the sector code and name to this table; turn jul_2021 column into a proper number, and rename it.  Then select only three columns we need. </span></span>
<span id="cb293-21"><a href="advanced-rvest.html#cb293-21" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> employment_info[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb293-22"><a href="advanced-rvest.html#cb293-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb293-23"><a href="advanced-rvest.html#cb293-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb293-24"><a href="advanced-rvest.html#cb293-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(each_row_df) <span class="sc">%&gt;%</span></span>
<span id="cb293-25"><a href="advanced-rvest.html#cb293-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">jul_2021 =</span> <span class="fu">parse_number</span>(jul_2021)) <span class="sc">%&gt;%</span></span>
<span id="cb293-26"><a href="advanced-rvest.html#cb293-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">jul_2021_employees =</span> jul_2021) <span class="sc">%&gt;%</span></span>
<span id="cb293-27"><a href="advanced-rvest.html#cb293-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(sector,description,jul_2021_employees) </span>
<span id="cb293-28"><a href="advanced-rvest.html#cb293-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-29"><a href="advanced-rvest.html#cb293-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To help us see what&#39;s happening as we build this, we&#39;re going to print the thing we&#39;re creating.  </span></span>
<span id="cb293-30"><a href="advanced-rvest.html#cb293-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(employment_info)</span>
<span id="cb293-31"><a href="advanced-rvest.html#cb293-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-32"><a href="advanced-rvest.html#cb293-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-33"><a href="advanced-rvest.html#cb293-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   sector description                                jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                                   &lt;dbl&gt;
## 1 11     Agriculture, Forestry, Fishing and Hunting                7.6
## # A tibble: 1 x 3
##   sector description                                   jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                                      &lt;dbl&gt;
## 1 21     Mining, Quarrying, and Oil and Gas Extraction               592.
## # A tibble: 1 x 3
##   sector description jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                    &lt;dbl&gt;
## 1 22     Utilities                 539.
## # A tibble: 1 x 3
##   sector description  jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                     &lt;dbl&gt;
## 1 23     Construction               7425
## # A tibble: 1 x 3
##   sector description   jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                      &lt;dbl&gt;
## 1 31-33  Manufacturing              12389
## # A tibble: 1 x 3
##   sector description     jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                        &lt;dbl&gt;
## 1 42     Wholesale Trade              5722.
## # A tibble: 1 x 3
##   sector description  jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                     &lt;dbl&gt;
## 1 44-45  Retail Trade             15355.
## # A tibble: 1 x 3
##   sector description                    jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                       &lt;dbl&gt;
## 1 48-49  Transportation and Warehousing              5793.
## # A tibble: 1 x 3
##   sector description jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                    &lt;dbl&gt;
## 1 51     Information               2745
## # A tibble: 1 x 3
##   sector description           jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                              &lt;dbl&gt;
## 1 52     Finance and Insurance              6545.
## # A tibble: 1 x 3
##   sector description                        jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                           &lt;dbl&gt;
## 1 53     Real Estate and Rental and Leasing              2292.
## # A tibble: 1 x 3
##   sector description                                      jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                                         &lt;dbl&gt;
## 1 54     Professional, Scientific, and Technical Services               9839
## # A tibble: 1 x 3
##   sector description                             jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                                &lt;dbl&gt;
## 1 55     Management of Companies and Enterprises              2330.
## # A tibble: 1 x 3
##   sector description                                           jul_2021_employe…
##   &lt;chr&gt;  &lt;chr&gt;                                                             &lt;dbl&gt;
## 1 56     Administrative and Support and Waste Management and …             8770.
## # A tibble: 1 x 3
##   sector description          jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                             &lt;dbl&gt;
## 1 61     Educational Services              3576.
## # A tibble: 1 x 3
##   sector description                       jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                          &lt;dbl&gt;
## 1 62     Health Care and Social Assistance             20045.
## # A tibble: 1 x 3
##   sector description                         jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                            &lt;dbl&gt;
## 1 71     Arts, Entertainment, and Recreation              2093.
## # A tibble: 1 x 3
##   sector description                     jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                        &lt;dbl&gt;
## 1 72     Accommodation and Food Services             13115.
## # A tibble: 1 x 3
##   sector description                                   jul_2021_employees
##   &lt;chr&gt;  &lt;chr&gt;                                                      &lt;dbl&gt;
## 1 81     Other Services (except Public Administration)               5709</code></pre>
<p>We’re getting very close to the finished table we showed at the beginning.</p>
<p>But right now, each bit of sector information is separated between 19 different dataframes.</p>
<p>We want them in one dataframe.</p>
<p>We can fix this by creating an empty dataframe called “employment_by_sector_all” using tibble(), placing it before our “for loop.”</p>
<p>And inside our “for loop” at the end, we’ll bind each employment_info dataframe to the newly created empty dataframe.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="advanced-rvest.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty dataframe to hold results </span></span>
<span id="cb295-2"><a href="advanced-rvest.html#cb295-2" aria-hidden="true" tabindex="-1"></a>employment_by_sector_all <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb295-3"><a href="advanced-rvest.html#cb295-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-4"><a href="advanced-rvest.html#cb295-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop, iterating over each row in our naics industry dataframe</span></span>
<span id="cb295-5"><a href="advanced-rvest.html#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row_number <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(naics_industry)) {</span>
<span id="cb295-6"><a href="advanced-rvest.html#cb295-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb295-7"><a href="advanced-rvest.html#cb295-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the row for a given row number, get rid of every other row</span></span>
<span id="cb295-8"><a href="advanced-rvest.html#cb295-8" aria-hidden="true" tabindex="-1"></a>    each_row_df <span class="ot">&lt;-</span> naics_industry <span class="sc">%&gt;%</span></span>
<span id="cb295-9"><a href="advanced-rvest.html#cb295-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(row_number) </span>
<span id="cb295-10"><a href="advanced-rvest.html#cb295-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb295-11"><a href="advanced-rvest.html#cb295-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define url of page to get</span></span>
<span id="cb295-12"><a href="advanced-rvest.html#cb295-12" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> each_row_df<span class="sc">$</span>sector_url</span>
<span id="cb295-13"><a href="advanced-rvest.html#cb295-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb295-14"><a href="advanced-rvest.html#cb295-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define id of table to ingest</span></span>
<span id="cb295-15"><a href="advanced-rvest.html#cb295-15" aria-hidden="true" tabindex="-1"></a>    xpath_employment_table <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;//*[@id=&quot;&#39;</span>,each_row_df<span class="sc">$</span>sector_xpath_id,<span class="st">&#39;&quot;]&#39;</span>)</span>
<span id="cb295-16"><a href="advanced-rvest.html#cb295-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb295-17"><a href="advanced-rvest.html#cb295-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get employment table from each page by going to each url defined above, reading in the html with read_html(), extracting the table with the id generated by the xpath code using html_elements), and then turning the html into a proper dataframe using html_table().  The dataframe is in a nested list, which we&#39;ll have to extract in the next step.</span></span>
<span id="cb295-18"><a href="advanced-rvest.html#cb295-18" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> url <span class="sc">%&gt;%</span></span>
<span id="cb295-19"><a href="advanced-rvest.html#cb295-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb295-20"><a href="advanced-rvest.html#cb295-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_elements</span>(<span class="at">xpath =</span> xpath_employment_table) <span class="sc">%&gt;%</span></span>
<span id="cb295-21"><a href="advanced-rvest.html#cb295-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() </span>
<span id="cb295-22"><a href="advanced-rvest.html#cb295-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb295-23"><a href="advanced-rvest.html#cb295-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grab the dataframe out of the list (it&#39;s the first and only element inside the list); clean up the field names with clean_names(); use slice(2) to keep only the second row; use bind_cols() to append the sector code and name to this table; turn jul_2021 column into a proper number, and rename it.  Then select only three columns we need. </span></span>
<span id="cb295-24"><a href="advanced-rvest.html#cb295-24" aria-hidden="true" tabindex="-1"></a>    employment_info <span class="ot">&lt;-</span> employment_info[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb295-25"><a href="advanced-rvest.html#cb295-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb295-26"><a href="advanced-rvest.html#cb295-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb295-27"><a href="advanced-rvest.html#cb295-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(each_row_df) <span class="sc">%&gt;%</span></span>
<span id="cb295-28"><a href="advanced-rvest.html#cb295-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">jul_2021 =</span> <span class="fu">parse_number</span>(jul_2021)) <span class="sc">%&gt;%</span></span>
<span id="cb295-29"><a href="advanced-rvest.html#cb295-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">jul_2021_employees =</span> jul_2021) <span class="sc">%&gt;%</span></span>
<span id="cb295-30"><a href="advanced-rvest.html#cb295-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(sector,description,jul_2021_employees) </span>
<span id="cb295-31"><a href="advanced-rvest.html#cb295-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb295-32"><a href="advanced-rvest.html#cb295-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bind each individual employment info table to our employment_by_sector_all dataframe</span></span>
<span id="cb295-33"><a href="advanced-rvest.html#cb295-33" aria-hidden="true" tabindex="-1"></a>    employment_by_sector_all <span class="ot">&lt;-</span> employment_by_sector_all <span class="sc">%&gt;%</span></span>
<span id="cb295-34"><a href="advanced-rvest.html#cb295-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(employment_info)</span>
<span id="cb295-35"><a href="advanced-rvest.html#cb295-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb295-36"><a href="advanced-rvest.html#cb295-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb295-37"><a href="advanced-rvest.html#cb295-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-38"><a href="advanced-rvest.html#cb295-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the completed dataframe</span></span>
<span id="cb295-39"><a href="advanced-rvest.html#cb295-39" aria-hidden="true" tabindex="-1"></a>employment_by_sector_all</span></code></pre></div>
<pre><code>## # A tibble: 19 x 3
##    sector description                                          jul_2021_employe…
##    &lt;chr&gt;  &lt;chr&gt;                                                            &lt;dbl&gt;
##  1 11     Agriculture, Forestry, Fishing and Hunting                         7.6
##  2 21     Mining, Quarrying, and Oil and Gas Extraction                    592. 
##  3 22     Utilities                                                        539. 
##  4 23     Construction                                                    7425  
##  5 31-33  Manufacturing                                                  12389  
##  6 42     Wholesale Trade                                                 5722. 
##  7 44-45  Retail Trade                                                   15355. 
##  8 48-49  Transportation and Warehousing                                  5793. 
##  9 51     Information                                                     2745  
## 10 52     Finance and Insurance                                           6545. 
## 11 53     Real Estate and Rental and Leasing                              2292. 
## 12 54     Professional, Scientific, and Technical Services                9839  
## 13 55     Management of Companies and Enterprises                         2330. 
## 14 56     Administrative and Support and Waste Management and…            8770. 
## 15 61     Educational Services                                            3576. 
## 16 62     Health Care and Social Assistance                              20045. 
## 17 71     Arts, Entertainment, and Recreation                             2093. 
## 18 72     Accommodation and Food Services                                13115. 
## 19 81     Other Services (except Public Administration)                   5709</code></pre>
<p>Ta da! The end result is a nice tidy dataframe with the number of employees in June 2021 for each sector.</p>
<p>It’s always a good idea to spot check the results, especially any values that look suspciously high or low.</p>
<p>The value for “Agriculture, Forestry, Fishing and Hunting” seems suspiciously low, compared with the other values.</p>
<p>Let’s figure out why.</p>
<p>Here’s the table on the mining sector page: <a href="https://www.bls.gov/iag/tgs/iag21.htm">https://www.bls.gov/iag/tgs/iag21.htm</a></p>
<p><img src="images/advrvest3.png" /><!-- -->
And here’s the table for the agriculture sector.</p>
<p><img src="images/advrvest4.png" /><!-- -->
Unlike mining – and every other sector page (I checked each page) – the agriculture page is structured differently.</p>
<p>In the second row of this table, it has the unemployment rate. Nowhere on the page can we find information on the number of employees. We would need to do additional research to track down a valid number if we plan on using this table, but for now we’re going to replace it with an NA using na_if.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="advanced-rvest.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the suspicious value for agriculture. </span></span>
<span id="cb297-2"><a href="advanced-rvest.html#cb297-2" aria-hidden="true" tabindex="-1"></a>employment_by_sector_all <span class="ot">&lt;-</span> employment_by_sector_all <span class="sc">%&gt;%</span></span>
<span id="cb297-3"><a href="advanced-rvest.html#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">jul_2021_employees =</span> <span class="fu">na_if</span>(jul_2021_employees,<span class="fl">7.5</span>))</span>
<span id="cb297-4"><a href="advanced-rvest.html#cb297-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-5"><a href="advanced-rvest.html#cb297-5" aria-hidden="true" tabindex="-1"></a><span class="co"># display it</span></span>
<span id="cb297-6"><a href="advanced-rvest.html#cb297-6" aria-hidden="true" tabindex="-1"></a>employment_by_sector_all</span></code></pre></div>
<pre><code>## # A tibble: 19 x 3
##    sector description                                          jul_2021_employe…
##    &lt;chr&gt;  &lt;chr&gt;                                                            &lt;dbl&gt;
##  1 11     Agriculture, Forestry, Fishing and Hunting                         7.6
##  2 21     Mining, Quarrying, and Oil and Gas Extraction                    592. 
##  3 22     Utilities                                                        539. 
##  4 23     Construction                                                    7425  
##  5 31-33  Manufacturing                                                  12389  
##  6 42     Wholesale Trade                                                 5722. 
##  7 44-45  Retail Trade                                                   15355. 
##  8 48-49  Transportation and Warehousing                                  5793. 
##  9 51     Information                                                     2745  
## 10 52     Finance and Insurance                                           6545. 
## 11 53     Real Estate and Rental and Leasing                              2292. 
## 12 54     Professional, Scientific, and Technical Services                9839  
## 13 55     Management of Companies and Enterprises                         2330. 
## 14 56     Administrative and Support and Waste Management and…            8770. 
## 15 61     Educational Services                                            3576. 
## 16 62     Health Care and Social Assistance                              20045. 
## 17 71     Arts, Entertainment, and Recreation                             2093. 
## 18 72     Accommodation and Food Services                                13115. 
## 19 81     Other Services (except Public Administration)                   5709</code></pre>
<p>And we’re done.</p>
<p>A note about advanced scraping – every site is different. Every time you want to scrape a site, you’ll be puzzling over different problems. But the steps remain the same: find a pattern, exploit it, clean the data on the fly and put it into a place to store it.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scraping-data-with-rvest.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="intro-to-apis-the-census.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/15-advancedrvest.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["datajournalism.pdf", "datajournalism.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
