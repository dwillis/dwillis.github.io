<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.646">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Journalism with R and the Tidyverse - 19&nbsp; Data Cleaning Part II: Janitor</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./open-refine.html" rel="next">
<link href="./data-cleaning-part-i.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Data Cleaning Part II: Janitor</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Journalism with R and the Tidyverse</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-story.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Learn a new way to read</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./start-math.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Newsroom math</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xl-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xl-refresher.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">An Excel Refresher</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xl-filter-sort.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Sorting and filtering to find stories</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xl-formulas.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Formulas in Google Sheets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xl-practice-noc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Practice exercise</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ethics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Ethics in data journalism</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./publicrecords.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Public records</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./github.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using GitHub</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-basics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">R Basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./replication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data journalism in the age of replication</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aggregates.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Aggregates</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mutating.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Mutating data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workingwithdates.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Working with dates</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./filters.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Filters and selections</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-cleaning-part-i.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Cleaning Part I: Data smells</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-cleaning-part-ii.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Data Cleaning Part II: Janitor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./open-refine.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Data Cleaning Part III: Open Refine</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pdfs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Cleaning Data Part IV: PDFs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./merging.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Combining and joining</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rvest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Scraping data with Rvest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./census.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Intro to APIs: The Census</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualizing-for-reporting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Visualizing your data for reporting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualizing-for-publication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Visualizing your data for publication</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./geographic-basics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Geographic data basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./geographicanalysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Geographic analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./textanalysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">An intro to text analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basicstats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Basic Stats: Linear Regression and The T-Test</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./writingwithdata.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Writing with numbers</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#cleaning-headers" id="toc-cleaning-headers" class="nav-link active" data-scroll-target="#cleaning-headers"> <span class="header-section-number">19.1</span> Cleaning headers</a></li>
  <li><a href="#changing-data-types" id="toc-changing-data-types" class="nav-link" data-scroll-target="#changing-data-types"> <span class="header-section-number">19.2</span> Changing data types</a></li>
  <li><a href="#duplicates" id="toc-duplicates" class="nav-link" data-scroll-target="#duplicates"> <span class="header-section-number">19.3</span> Duplicates</a></li>
  <li><a href="#cleaning-strings" id="toc-cleaning-strings" class="nav-link" data-scroll-target="#cleaning-strings"> <span class="header-section-number">19.4</span> Cleaning strings</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Data Cleaning Part II: Janitor</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>The bane of every data analyst’s existence is data cleaning.</p>
<p>Every developer, every data system, every agency, the all have opinions about how data gets collected. Some decisions make sense from the outside. Some decisions are based entirely on internal politics: who is creating the data, how they are creating it, why they are creating it. Is it automated? Is it manual? Are data normalized? Are there free form fields where users can just type into or does the system restrict them to choices?</p>
<p>Your journalistic questions – what you want the data to tell you – is almost never part of that equation.</p>
<p>So cleaning data is the process of fixing issues in your data so you can answer the questions you want to answer. Data cleaning is a critical step that you can’t skip past. A standard metric is that 80 percent of the time working with data will be spent cleaning and verifying data, and 20 percent the more exciting parts like analysis and visualization.</p>
<p>The tidyverse has a lot of built-in tools for data cleaning. We’re also going to make use of a new library, called <code>janitor</code> that has a bunch of great functions for cleaning data. Let’s load those now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.7     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'janitor'

The following objects are masked from 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
</div>
<p>Now let’s load a tiny slice of our Maryland WinRed contributions. To make the cleaning demonstration in this chapter easier, this dataset only has 14 rows, all from Conowingo, Maryland.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>conowingo <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/conowingo.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s glimpse it to get a sense of it, to examine the column data types and possible values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(conowingo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 14
Columns: 21
$ `1_linenumber`   &lt;chr&gt; "SA11AI", "SA11AI", "SA11AI", "SA11AI", "SA11AI", "SA…
$ fec_committee_id &lt;chr&gt; "C00694323", "C00694323", "C00694323", "C00694323", "…
$ tran_id          &lt;chr&gt; "AC8C7155172624C54909", "A61211F59EBD8451C8A8", "A9C8…
$ flag_orgind      &lt;chr&gt; "IND", "IND", "IND", "IND", "IND", "IND", "IND", "IND…
$ LAST_NAME        &lt;chr&gt; "Pabis", "Garvey", "Huddleston", "Huddleston", "Buona…
$ first_name       &lt;chr&gt; "Sherry", "Brian", "Deborah", "Deborah", "Wm", "Debor…
$ middle_name      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
$ prefix           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
$ suffix           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
$ `address one`    &lt;chr&gt; "144 Bill Leight Rd", "116 Finnegans Pl", "118 Merry …
$ address_two      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA
$ city             &lt;chr&gt; "Conowingo", "Conowing", "conowingo", "Conowingo", "C…
$ state            &lt;chr&gt; "MD", "MD", "MD", "MD", "MD", "MD", "MD", "MD", "MD",…
$ zip              &lt;chr&gt; "21918", "21918", "21918", "21918", "21918", "21918-2…
$ date             &lt;date&gt; 2022-04-16, 2022-06-24, 2022-06-15, 2022-06-18, 2022-…
$ amount           &lt;chr&gt; "45", "35", "25", "25", "25", "25", "15", "10", "5.76…
$ aggregate_amount &lt;dbl&gt; 180, 35, 45, 95, 41, 70, 15, 41, 41, 41, 41, 41, 41, …
$ employer         &lt;chr&gt; "SELF-EMPLOYED", "US ARMY", "RETIRED", "RETIRED", "JR…
$ occupation       &lt;chr&gt; "SOFTWARE ENGINEER", "INFORMATION REQUESTED", "RETIR…
$ memo_text        &lt;chr&gt; "Earmarked for SAVE AMERICA JOINT FUNDRAISING COMMITT…
$ cycle            &lt;dbl&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022,…</code></pre>
</div>
</div>
<p>And let’s examine the full data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 21
   `1_linenumber` fec_committee_id tran_id      flag_orgind LAST_NAME first_name
   &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI         C00694323        AC8C7155172… IND         Pabis     Sherry    
 2 SA11AI         C00694323        A61211F59EB… IND         Garvey    Brian     
 3 SA11AI         C00694323        A9C895B091C… IND         Huddlest… Deborah   
 4 SA11AI         C00694323        ABAA82A5E70… IND         Huddlest… Deborah   
 5 SA11AI         C00694323        A45519E3246… IND         Buonaugu… Wm        
 6 SA11AI         C00694323        A33987D736E… IND         Huddlest… Deborah   
 7 SA11AI         C00694323        AE7C6D0C074… IND         Hamilton  Derrick   
 8 SA11AI         C00694323        A07D7A1ECE3… IND         Buonaugu… Wm        
 9 SA11AI         C00694323        A290335F896… IND         Buonaugu… Wm        
10 SA11AI         C00694323        AD6C11068B7… IND         Buonaugu… Wm        
11 SA11AI         C00694323        A99BBCB87D5… IND         Buonaugu… Wm        
12 SA11AI         C00694323        A142B275F78… IND         Buonaugu… Wm        
13 SA11AI         C00694323        AF8E4C98168… IND         Buonaugu… Wm        
14 SA11AI         C00694323        AE7C6D0C074… IND         Hamilton  Derrick   
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   `address one` &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;chr&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>There are a number of issues with this data set that might get in the way of asking questions and receiving accurate answers. They are:</p>
<ul>
<li>The column headers are inconsistently styled (note: I’ve purposely dirtied these up, which is why they look different than previous versions of this data we’ve loaded). The first column “1_linenumber” starts with a number. The “NAME” column is all caps, while the rest are lowercase. And “address one” has a space in it. Those problems will make them hard to analyze, to refer to in functions we write.</li>
<li>The amount column is stored as a character, not a number. If we try to do math to it – say, calculate the average loan size – it won’t work.</li>
<li>There’s a fully duplicated row – a common problem in data sets. The first row is exactly the same as the second.</li>
<li>The city field has five different forms – including misspellings – of Arnold. If we wanted to group and count the number of loans in Arnold, this inconsistency would not let us do that correctly.</li>
<li>The zip field mixes five digit ZIP codes and nine digit ZIP codes. If we wanted to group and count the number of loans in a given ZIP code, this inconsistency would not let us do that correctly.</li>
<li>The street address field is inconsistent. It has multiple variations of Merry Knoll Lane.</li>
</ul>
<p>Let’s get cleaning. Our goal will be to build up one block of code that does all the necessary cleaning in order to answer this question: what is the total amount of contributions from Conowingo, MD in ZIP code 21918?</p>
<section id="cleaning-headers" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="cleaning-headers"><span class="header-section-number">19.1</span> Cleaning headers</h2>
<p>One of the first places we can start with cleaning data is cleaning the column names (or headers).</p>
<p>Every system has their own way of recording headers, and every developer has their own thoughts of what a good idea is within it. R is most happy when headers are lower case, without special characters.</p>
<p>If column headers start with a number, or have a space in between two words, you have to set them off with backticks when using them in a function. Generally speaking, we want one word (or words separated by an underscore), all lowercase, that don’t start with numbers.</p>
<p>The <code>janitor</code> library makes fixing headers trivially simple with the function <code>clean_names()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 21
   x1_linenumber fec_committee_id tran_id       flag_orgind last_name first_name
   &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI        C00694323        AC8C71551726… IND         Pabis     Sherry    
 2 SA11AI        C00694323        A61211F59EBD… IND         Garvey    Brian     
 3 SA11AI        C00694323        A9C895B091C8… IND         Huddlest… Deborah   
 4 SA11AI        C00694323        ABAA82A5E70D… IND         Huddlest… Deborah   
 5 SA11AI        C00694323        A45519E3246C… IND         Buonaugu… Wm        
 6 SA11AI        C00694323        A33987D736EC… IND         Huddlest… Deborah   
 7 SA11AI        C00694323        AE7C6D0C0742… IND         Hamilton  Derrick   
 8 SA11AI        C00694323        A07D7A1ECE3C… IND         Buonaugu… Wm        
 9 SA11AI        C00694323        A290335F896E… IND         Buonaugu… Wm        
10 SA11AI        C00694323        AD6C11068B72… IND         Buonaugu… Wm        
11 SA11AI        C00694323        A99BBCB87D53… IND         Buonaugu… Wm        
12 SA11AI        C00694323        A142B275F787… IND         Buonaugu… Wm        
13 SA11AI        C00694323        AF8E4C981687… IND         Buonaugu… Wm        
14 SA11AI        C00694323        AE7C6D0C0742… IND         Hamilton  Derrick   
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;chr&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This function changed <code>LAST_NAME</code> to <code>last_name</code>. It put an underscore in <code>address_one</code> to get rid of the space. And it changed <code>1_linenumber</code> to <code>x1_linenumber</code>. That last one was an improvement – it no longer starts with a number – but it’s still kind of clunky.</p>
<p>We can use a tidyverse function <code>rename()</code> to fix that. Let’s just call it <code>linenumber</code>. NOTE: when using <code>rename()</code>, the <em>new</em> name comes first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
14 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;chr&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="changing-data-types" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="changing-data-types"><span class="header-section-number">19.2</span> Changing data types</h2>
<p>Right now, the amount column is stored as a character. Do you see the little <code>&lt;chr&gt;</code> under the amount column in the table above? If we wanted to do math to it, we’d get an error, like so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>total_conowingo <span class="ot">&lt;-</span> cleaned_conowingo <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_amount =</span> <span class="fu">sum</span>(amount))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
! Problem while computing `total_amount = sum(amount)`.
Caused by error in `sum()`:
! invalid 'type' (character) of argument</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>total_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'total_conowingo' not found</code></pre>
</div>
</div>
<p>We got an “invalid ‘type’ (character)” error. So let’s fix that using the mutate() function in concert with as.numeric(). We’ll reuse the same column name, so it overwrites it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amount =</span> <span class="fu">as.numeric</span>(amount))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
14 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Notice that the amount has been converted to a <code>&lt;dbl&gt;</code>, which is short for double, a number format. When we attempt to add up all of the amounts to create a total, this time it works fine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>total_conowingo <span class="ot">&lt;-</span> cleaned_conowingo <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_amount =</span> <span class="fu">sum</span>(amount))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>total_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  total_amount
         &lt;dbl&gt;
1          226</code></pre>
</div>
</div>
</section>
<section id="duplicates" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="duplicates"><span class="header-section-number">19.3</span> Duplicates</h2>
<p>One of the most difficult problems to fix in data is duplicate records in the data. They can creep in with bad joins, bad data entry practices, mistakes – all kinds of reasons. A duplicated record isn’t always there because of an error, but you need to know if it’s there before making that determination.</p>
<p>So the question is, do we have any records repeated?</p>
<p>Here we’ll use a function called <code>get_dupes</code> from the janitor library to check for fully repeated records in our cleaned data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_dupes</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No variable names specified - using all columns.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 22
  linenumber fec_committee_id tran_id           flag_orgind last_name first_name
  &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
1 SA11AI     C00694323        AE7C6D0C074234DC… IND         Hamilton  Derrick   
2 SA11AI     C00694323        AE7C6D0C074234DC… IND         Hamilton  Derrick   
# … with 16 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;, dupe_count &lt;int&gt;</code></pre>
</div>
</div>
<p>In this case, a contribution by Derrick Hamilton in our table is fully duplicated. Every field is identical in each.</p>
<p>We can fix this by adding the function <code>distinct()</code> to our cleaning script. This will keep only one copy of each unique record in our table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amount =</span> <span class="fu">as.numeric</span>(amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="cleaning-strings" class="level2" data-number="19.4">
<h2 data-number="19.4" class="anchored" data-anchor-id="cleaning-strings"><span class="header-section-number">19.4</span> Cleaning strings</h2>
<p>The rest of the problems with this data set all have to do with inconsistent format of values in a few of the columns. To fix these problems, we’re going to make use of mutate() and a new function, <code>case_when()</code> in concert with “string functions” – special functions that allow us to clean up columns stored as character strings. The tidyverse package <code>stringr</code> has lots of useful string functions, more than we’ll learn in this chapter.</p>
<p>Let’s start by cleaning up the zip field. Remember, three of rows had a five-digit ZIP code, while two had a nine-digit ZIP code, separated by a hyphen.</p>
<p>We’re going to write code that tells R to keep the first five digits on the left, and get rid of anything after that by using <code>mutate()</code> in concert with <code>str_sub()</code>, from the <code>stringr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amount =</span> <span class="fu">as.numeric</span>(amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip =</span> <span class="fu">str_sub</span>(zip, <span class="at">start=</span>1L, <span class="at">end=</span>5L))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Let’s break down this line of code. It says: take the value in each zip column and extract the first character on the left (1L) through the fifth character on the left (5L), and then use that five-digit zip to overwrite the zip column.</p>
<p>We’ll use a different set of functions to standardize how we standardize the different flavors of the word “Conowingo” in the city column. Let’s start by changing every value to title case – first letter uppercase, subsequent letters lowercase – using the <code>str_to_title()</code> function from <code>stringr</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amount =</span> <span class="fu">as.numeric</span>(amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip =</span> <span class="fu">str_sub</span>(zip, <span class="at">start=</span>1L, <span class="at">end=</span>5L)) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_to_title</span>(city))</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>That was enough to standardize two values (CONOWINGO and conowingo). The only ones that remain are the two clear misspellings (Conowing and Conowingoo). To fix those, we’re going to do some manual editing. And for that, we’re going to use <code>case_when()</code>, a function that let’s us say if a value meets a certain condition, then change it, and if it doesn’t, don’t change it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amount =</span> <span class="fu">as.numeric</span>(amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip =</span> <span class="fu">str_sub</span>(zip, <span class="at">start=</span>1L, <span class="at">end=</span>5L)) <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_to_title</span>(city)) <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    city <span class="sc">==</span> <span class="st">"Conowing"</span> <span class="sc">~</span> <span class="st">"Conowingo"</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> city</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This is a little complex, so let’s break it down.</p>
<p>What the code above says, in English, is this: Look at all the values in the city column. If the value is “Conowing”, then (that’s what the “~” means, then) replace it with the word “Conowingo”. If it’s anything other than that (that’s what “TRUE” means, otherwise), then keep the existing value in that column.</p>
<p>We could fix “Conowingoo” by adding another line inside that function, that looks identical: <code>city == "Conowingoo" ~ "Conowingo"</code>. Like so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amount =</span> <span class="fu">as.numeric</span>(amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip =</span> <span class="fu">str_sub</span>(zip, <span class="at">start=</span>1L, <span class="at">end=</span>5L)) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_to_title</span>(city)) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    city <span class="sc">==</span> <span class="st">"Conowing"</span> <span class="sc">~</span> <span class="st">"Conowingo"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    city <span class="sc">==</span> <span class="st">"Conowingoo"</span> <span class="sc">~</span> <span class="st">"Conowingo"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> city</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Instead of specifying the exact value, we can also solve the problem by using something more generalizable, using a function called str_detect(), which allows us to search parts of words.</p>
<p>The second line of our case_when() function below now says, in English: look in the city column. If you find that one of the values starts with “Conowing” (the “^” symbol means “starts with”), then (the tilde ~ means then) change it to “Conowingo”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning function</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo <span class="ot">&lt;-</span> conowingo <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">linenumber =</span> x1_linenumber) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amount =</span> <span class="fu">as.numeric</span>(amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip =</span> <span class="fu">str_sub</span>(zip, <span class="at">start=</span>1L, <span class="at">end=</span>5L)) <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_to_title</span>(city)) <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(city,<span class="st">"^Conowing"</span>) <span class="sc">~</span> <span class="st">"Conowingo"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> city</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># display the cleaned dataset</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>cleaned_conowingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 21
   linenumber fec_committee_id tran_id          flag_orgind last_name first_name
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     
 1 SA11AI     C00694323        AC8C7155172624C… IND         Pabis     Sherry    
 2 SA11AI     C00694323        A61211F59EBD845… IND         Garvey    Brian     
 3 SA11AI     C00694323        A9C895B091C8A4A… IND         Huddlest… Deborah   
 4 SA11AI     C00694323        ABAA82A5E70D445… IND         Huddlest… Deborah   
 5 SA11AI     C00694323        A45519E3246C947… IND         Buonaugu… Wm        
 6 SA11AI     C00694323        A33987D736EC447… IND         Huddlest… Deborah   
 7 SA11AI     C00694323        AE7C6D0C074234D… IND         Hamilton  Derrick   
 8 SA11AI     C00694323        A07D7A1ECE3C44B… IND         Buonaugu… Wm        
 9 SA11AI     C00694323        A290335F896EC41… IND         Buonaugu… Wm        
10 SA11AI     C00694323        AD6C11068B72B40… IND         Buonaugu… Wm        
11 SA11AI     C00694323        A99BBCB87D53C45… IND         Buonaugu… Wm        
12 SA11AI     C00694323        A142B275F787E48… IND         Buonaugu… Wm        
13 SA11AI     C00694323        AF8E4C981687E4D… IND         Buonaugu… Wm        
# … with 15 more variables: middle_name &lt;lgl&gt;, prefix &lt;lgl&gt;, suffix &lt;lgl&gt;,
#   address_one &lt;chr&gt;, address_two &lt;lgl&gt;, city &lt;chr&gt;, state &lt;chr&gt;, zip &lt;chr&gt;,
#   date &lt;date&gt;, amount &lt;dbl&gt;, aggregate_amount &lt;dbl&gt;, employer &lt;chr&gt;,
#   occupation &lt;chr&gt;, memo_text &lt;chr&gt;, cycle &lt;dbl&gt;</code></pre>
</div>
</div>
<p>By using str_detect(city,“^Conowing”), we pick up any values that start with “Conowing”, so it would change all four of these. If we used city == “Conowing”, it would only pick up one.</p>
<p>Lastly, there’s the issue with inconsistent spelling of Merry Knoll Lane in the street address column. Do we need to clean this?</p>
<p>Remember the motivating question that’s driving us to do this cleaning: what is the total amount of contributions from Conowingo, MD in ZIP code 21918?</p>
<p>We don’t need the street_address field to answer that question. So we’re not going to bother cleaning it.</p>
<p>That’s a good approach for the future. A good rule of thumb is that you should only spend time cleaning fields that are critical to the specific analysis you want to do.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data-cleaning-part-i.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Cleaning Part I: Data smells</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./open-refine.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Data Cleaning Part III: Open Refine</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>